<blockquote>
<p><a href="https://www.inflearn.com/course/%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-%EC%9E%85%EB%AC%B8/dashboard">ì´ˆë³´ë¥¼ ìœ„í•œ ì¿ ë²„ë„¤í‹°ìŠ¤ ì•ˆë‚´ì„œ - ì¸í”„ëŸ° | ê°•ì˜</a></p>
</blockquote>
<p>ë…¸ì…˜ì— ì •ë¦¬í•´ë‘ì—ˆë˜ ìë£Œë¥¼ ë¸”ë¡œê·¸ë¡œ ì˜®ê²¨ ì˜µë‹ˆë‹¤.</p>
<p>ê¸°ë¶„ ì¢‹ì€ ê°•ì˜ ìˆ˜ë£Œì¦ë„ ì²¨ë¶€í•´ ë´…ë‹ˆë‹¤:)
<img alt="" src="https://velog.velcdn.com/images/jaehere/post/7fa9758b-ee57-4683-bf80-d59f80e3c2ec/image.png" /></p>
<hr />
<h2 id="0-ì¿ ë²„ë„¤í‹°ìŠ¤-ì‹œì‘í•˜ê¸°">#0 ì¿ ë²„ë„¤í‹°ìŠ¤ ì‹œì‘í•˜ê¸°</h2>
<p>ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜</p>
<ul>
<li><p>ì„œë²„ ìƒíƒœê´€ë¦¬</p>
<ul>
<li><p>ë¬¸ì„œí™” :  ë§Œë“¤ì–´ë‘¬ë„ í™˜ê²½ì´ë‚˜ os, ë²„ì „ì´ ë°”ë€Œë©´ ë”°ë¼í•´ë„ ì˜ ì•ˆë˜ëŠ” ë¬¸ì œ ë°œìƒ</p>
</li>
<li><p>ì„œë²„ê´€ë¦¬ë„êµ¬ : CHEF, ANSIBLE ë“± ë„êµ¬ê°€ ëŒ€ì‹ í•´ì„œ ëª…ë ¹ì–´ë¥¼ ë‚ ë ¤ì¤Œ. ì„¤ì •ê´€ë¦¬ë„êµ¬ë„ ë°°ì›Œì•¼í•˜ê³ , ì„œë²„ë¥¼ ë³µì¡í•˜ê²Œ ê´€ë¦¬ ì‹œ ë„êµ¬ ìì²´ì˜ ì‚¬ìš©ë²•ë„ ë‚œì´ë„ê°€ ë†’ì•„ì§€ëŠ” ë¬¸ì œ ë°œìƒ</p>
</li>
<li><p>ê°€ìƒë¨¸ì‹  : ê°€ìƒë¨¸ì‹  í•˜ë‚˜ ë„ìš°ê³  í”„ë¡œê·¸ë¨ í•˜ë‚˜ ì„¤ì¹˜í•´ë‘ë©´ ì¶©ëŒë‚  ì¼ë„ ì—†ê³ , ê°€ìƒë¨¸ì‹  ì—¬ëŸ¬ê°œë¥¼ ë¬¶ì–´ì„œ ì‚¬ìš©ë„ ê°€ëŠ¥. ê¸°ë³¸ì ìœ¼ë¡œ ëŠë¦¼. í´ë¼ìš°ë“œ í™˜ê²½ì— ì•ˆë§ëŠ” ë¶€ë¶„ ë°œìƒ. íŠ¹ì • vendorì— dependencyê°€ ìƒê¹€</p>
</li>
<li><p>docker : ëª¨ë“  ì‹¤í–‰í™˜ê²½ì„ ì»¨í…Œì´ë„ˆë¡œ ë°”ê¿ˆ. ë„ì»¤ë§Œ ì„¤ì¹˜ë˜ì–´ ìˆìœ¼ë©´ ì–´ë””ì„œë“  ë™ì‘. ì‚¬ìš©ë²• ì‰¬ì›€. vmì²˜ëŸ¼ ëŠë¦¬ì§€ ì•Šê³ , íš¨ìœ¨ì . ì„œë²„ ê´€ë¦¬ìì˜ ë³µì¡í•¨ì„ í•´ê²°</p>
<p>â†’ ì˜¤ì˜ˆ ë„ì»¤ ë“±ì¥</p>
</li>
</ul>
</li>
<li><p>ë„ì»¤ ì»¨í…Œì´ë„ˆ íŠ¹ì§•</p>
<ul>
<li><p>ê°€ìƒë¨¸ì‹ ê³¼ ë¹„êµí•˜ì—¬ ì»¨í…Œì´ë„ˆ ìƒì„±ì´ ì‰½ê³  íš¨ìœ¨ì </p>
</li>
<li><p>ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ë¥¼ ì´ìš©í•œ ë°°í¬ì™€ ë¡¤ë°±ì´ ê°„ë‹¨</p>
</li>
<li><p>ì–¸ì–´, í”„ë ˆì„ì›Œí¬ì— ìƒê´€ì—†ì´ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ ê´€ë¦¬</p>
</li>
<li><p>ê°œë°œ, í…ŒìŠ¤íŒ…,ìš´ì˜ í™˜ê²½ì€ ë¬¼ë¡  ë¡œì»¬ pc ì™€ í´ë¼ìš°ë“œê¹Œì§€ ë™ì¼í•œ í™˜ê²½ì„ êµ¬ì¶•</p>
</li>
<li><p>ì»¨í…Œì´ë„ˆëŠ” ì˜¤í”ˆì†ŒìŠ¤</p>
</li>
<li><p>íŠ¹ì • í´ë¼ìš°ë“œ ë²¤ë”ì— ì¢…ì†ì ì´ì§€ ì•ŠìŒ</p>
</li>
<li><p>ë„ì»¤ì´ë¯¸ì§€ë§Œ ì˜ ë§Œë“¤ì–´ì£¼ë©´ ê´€ë¦¬ ì‰¬ì›€</p>
</li>
<li><p>í”„ë¡œê·¸ë¨ì„ ì»¨í…Œì´ë„ˆí™” í•´ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒ :  containerization</p>
</li>
<li><p>Develop â†’ Build â†’ Ship â†’ Run</p>
<p>â†’ ì»¨í…Œì´ë„ˆ ìˆ˜ë°±ê°œê°€ ë˜ë©´ ê³ ë¯¼ì´ ë¨â€¦ ë„ì»¤ ì¢‹ê¸´í•œë° ë§ì€ ê±¸ ê´€ë¦¬í•˜ë ¤ë©´ ì—¬ì „íˆ ì† ë§ì´ ê°€..</p>
</li>
</ul>
</li>
</ul>
<ul>
<li>ë„ì»¤ì˜ ë¬¸ì œ<ul>
<li><blockquote>
<p>_ ssh ë„ì»¤ì„œë²„ 1,2,3ì— ì ‘ì†í•´ì„œ ì‹¤í–‰í•˜ëŠ” ê´€ë¦¬ê°€ ì–´ë ¤ìš´ ë¬¸ì œ ë°œìƒ</p>
</blockquote>
</li>
<li>ë„ì»¤ë¥¼ ë§ì´ ì‚¬ìš©í•˜ë‹¤ë³´ë©´ ë¹ˆê³µê°„ì´ ìƒê¸°ê¸° ë§ˆë ¨.. ì–´ë–¤ ì„œë²„ê°€ ì—¬ìœ ê°€ ìˆëŠ”ì§€ ë³´ë ¤ë©´ ëª¨ë‹ˆí„°ë§í•´ì•¼í•¨.</li>
<li>ë°°í¬ì‹œ í•˜ë‚˜í•˜ë‚˜ ì ‘ì†í•´ì„œ ë°°í¬, ë²„ì „ ë¬¸ì œ ì‹œ ë¡¤ì•„ì›ƒ/ë¡¤ë°± ì†ì´ ë§ì´ê°. ì¤‘ì•™ì—ì„œ ë²„ì „ ê´€ë¦¬ë¥¼ í•˜ê³ ì‹¶ë‹¤ëŠ” ìš•êµ¬ê°€ ë°œìƒ</li>
<li>ì„œë¹„ìŠ¤ ê²€ìƒ‰<ul>
<li>proxy â†’ WEB ì„ ê°€ë¦¬í‚´ proxyì— Webì„ ë°”ë¼ë´ë¼ ì„¤ì •.  webì´ ëª‡ê°œì¼ ê²½ìš°, LoadBalancer ì‚¬ìš©í•´ì„œ ë¶€í•˜ ë°©ì§€. ë„ˆë¬´ ë§ì•„ì§€ëŠ” ë¬¸ì œ. ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤</li>
</ul>
</li>
<li>ì„œë¹„ìŠ¤ ì´ìƒ, ë¶€í•˜ ëª¨ë‹ˆí„°ë§<ul>
<li>ëª‡ê°œì˜ ì»¨í…Œì´ë„ˆê°€ ì£½ëŠ” ê²½ìš°, ëª‡ë²ˆ ì„œë²„ê°€ ë¶€í•˜ ë°œìƒì˜ ê²½ìš° ìë™í™”ê°€ í•„ìš”í•¨</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>â†’ Container Orchestration : ë³µì¡í•œ ì»¨í…Œì´ë„ˆ í™˜ê²½ì„ íš¨ê³¼ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê¸° ìœ„í•œ ë„êµ¬</p>
<ul>
<li><p>ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ ì—­í•  - ì„œë²„ê´€ë¦¬ì ëŒ€ì‹  ì¼ í•´ì¤Œ. ì—­ìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ” ì¼ì´ í•„ìš”í•˜ê¸°ë„ í•¨</p>
<ul>
<li>CLUSTER<ul>
<li>ì¤‘ì•™ì œì–´(master-node)</li>
<li>nodeë¥¼ í•˜ë‚˜í•˜ë‚˜ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ cluster ë‹¨ìœ„ë¡œ ì¶”ìƒí™”í•˜ì—¬ ê´€ë¦¬</li>
<li>masterê°€ clusterë¥¼ ê´€ë¦¬í•˜ë©° , nodeë¼ë¦¬ ë„¤íŠ¸ì›Œí‚¹</li>
<li>node ì²˜ìŒ ì„¤ê³„ë‹¨ê³„ ì¤‘ìš”</li>
</ul>
</li>
<li>STATE  ìƒíƒœê´€ë¦¬<ul>
<li>ì§ì ‘ ì¡°ì¹˜ í•˜ì§€ ì•Šë”ë¼ë„ ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ì´ ìë™ìœ¼ë¡œ ë§ì¶°ì¤Œ</li>
</ul>
</li>
<li>SCHEDULING ë°°í¬ê´€ë¦¬</li>
<li>ROLLOUT ROLLBACK ë°°í¬ë²„ì „ê´€ë¦¬</li>
<li>SERVICE DISCOVERY ì„œë¹„ìŠ¤ ë“±ë¡ ë° ì¡°íšŒ<ul>
<li>web ë“±ë¡ í›„ proxyì„œë²„ëŠ” ì¡°íšŒí•˜ë©° ì„¤ì •ë³€ê²½, í”„ë¡œì„¸ìŠ¤ ì¬ì‹œì‘</li>
</ul>
</li>
<li>VOLUME ë³¼ë¥¨ ìŠ¤í† ë¦¬ì§€<ul>
<li>nodeì— ê°ê° í•„ìš”í•œ ë³¼ë¥¨ì„ amount í•¨</li>
</ul>
</li>
</ul>
</li>
<li><p>ì»¨í…Œì´ë„ˆ ê´€ë¦¬ë„êµ¬ ì¶˜ì¶”ì „êµ­ì‹œëŒ€ ã…‹ã…‹</p>
<ul>
<li>ì¿ ë²„ë„¤í‹°ìŠ¤ê°€ í‘œì¤€ì²˜ëŸ¼ ë“±ì¥~~</li>
</ul>
</li>
<li><p><strong>ì¿ ë²„ë„¤í‹°ìŠ¤ kubernetes</strong> : ì»¨í…Œì´ë„ˆë¥¼ <strong>ì‰½ê³  ë¹ ë¥´ê²Œ ë°°í¬/í™•ì¥</strong> í•˜ê³  <strong>ê´€ë¦¬ë¥¼ ìë™í™”</strong>í•´ì£¼ëŠ” ì˜¤í”ˆì†ŒìŠ¤ í”Œë«í¼</p>
<ul>
<li>êµ¬ê¸€ì—ì„œ ì²˜ìŒ ë§Œë“¬ 2015 ì²« ë¦´ë¦¬ì¦ˆ</li>
<li>CLOUD NATIVEë¡œ ì˜¤í”ˆì†ŒìŠ¤ ì´ê´€</li>
<li>ìš´ì˜ì—ì„œ ì‚¬ìš©ê°€ëŠ¥í•œ ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜</li>
<li>Planet Scale í–‰ì„±ìŠ¤ì¼€ì¼ 20ì–µê°œë³´ë‹¤ë§Œ ì ìœ¼ë©´ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ê³  â€¦</li>
<li>ë‹¤ì–‘í•œ ìš”êµ¬ì‚¬í•­ ë§Œì¡±í•˜ëŠ” ìœ ì—°ì„±, Run Anywhere</li>
<li>ì˜¤í”ˆì†ŒìŠ¤, ì»¤ë®¤ë‹ˆí‹° ë°œë‹¬, ë¬´í•œí•œ í™•ì¥ì„±, ì‚¬ì‹¤ìƒ í‘œì¤€(De facto)</li>
<li>ì¿ ë²„ë„¤í‹°ìŠ¤ Native Platform : Rancher, Red Hat OpenShift, Tanzu ì¿ ë²„ë„¤í‹°ìŠ¤ ìœ„ì— ë§Œë“¬<ul>
<li>ë„ì»¤ë„ ì¿ ë²„ë„¤í‹°ìŠ¤ë¥¼ ì§€ì›</li>
<li>EKS(Amazon), AKS(Azure), GKE(Google) í´ë¼ìš°ë“œ 3ëŒ€ì¥ ëª¨ë‘ ì¿ ë²„ë„¤í‹°ìŠ¤ë¥¼ ë§¤ë‹ˆì§€ë“œ ì„œë¹„ìŠ¤ë¡œ ì œê³µ</li>
</ul>
</li>
</ul>
</li>
<li><p>CNCF</p>
<ul>
<li>CLOUD NATIVE COMPUTING FOUNDATION (ë¦¬ëˆ…ìŠ¤ ì†Œì†)</li>
<li>í´ë¼ìš°ë“œ í™˜ê²½ì— ì í•©í•œ ì»´í“¨íŒ… ê¸°ìˆ ì„ ì§€ì›</li>
<li>ì¿ ë²„ë„¤í‹°ìŠ¤ê°€ í”Œë«í¼ì ì¸ ì—­í• , ê·¸ ìœ„ì— ì†Œí”„íŠ¸ì›¨ì–´ í”„ë¡œê·¸ë¨ì´ ëŒì•„ê°. â† ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ì˜ ì‚¬ì‹¤ìƒ í‘œì¤€ (de facto) Cloud Nativeì˜ í•µì‹¬ì—­í• </li>
</ul>
</li>
</ul>
<h2 id="1-ì¿ ë²„ë„¤í‹°ìŠ¤-ì•Œì•„ë³´ê¸°">#1 ì¿ ë²„ë„¤í‹°ìŠ¤ ì•Œì•„ë³´ê¸°</h2>
<ul>
<li>ì¿ ë²„ë„¤í‹°ìŠ¤ ìš©ì–´</li>
</ul>
<pre><code>| ìš©ì–´ | ë°œìŒ |
| --- | --- |
| master | ë§ˆìŠ¤í„° |
| node | ë…¸ë“œ(êµ¬ minion ë¯¸ë‹ˆì–¸) |
| k8s | ì¿ ë²„ë„¤í‹°ìŠ¤, ì¼€ì´ì—ì‡ì¸ , ì¼€ì´íŒ”ì—ìŠ¤ |
| kubectl | íë¸Œ ì»¨íŠ¸ë¡¤, íë¸Œ ì‹œí‹°ì—˜, íë¸Œì»¤ë“¤ |
| etcd | ì—£ì§€ë””, ì‡ì‹œë””, ì´í‹°ì‹œë”” |
| pod | íŒŸ, íŒŒë“œ, í¬ë“œ |
| istio | ì´ìŠ¤í‹°ì˜¤ |
| helm | í—¬ë¦„, í•¾, í–„ |
| knative | ì¼€ì´ ë„¤ì´í‹°ë¸Œ |</code></pre><ul>
<li><p>ì¿ ë²„ë„¤í‹°ìŠ¤ ì†Œê°œ</p>
<ul>
<li>ì»¨í…Œì´ë„ˆí™”ëœ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìë™ìœ¼ë¡œ ë°°í¬, ìŠ¤ì¼€ì¼ë§ ë° ê´€ë¦¬</li>
<li>ì»¨í…Œì´ë„ˆë¥¼ ì‰½ê²Œ ê´€ë¦¬í•˜ê³  ì—°ê²°í•˜ê¸° ìœ„í•œ ë…¼ë¦¬ì ì¸ ë‹¨ìœ„ë¡œ ê·¸ë£¹í™”</li>
<li>êµ¬ê¸€ì—ì„œ 15ë…„ê°„ ê²½í—˜ì„ í† ëŒ€ë¡œ ìµœìƒì˜ ì•„ì´ë””ì–´ì™€ ë°©ë²•ë“¤ì„ ê²°í•©<ul>
<li>borgâ†’k8s</li>
</ul>
</li>
<li>ê¸°ì—¬ì—…ì²´: êµ¬ê¸€, ì•„ë§ˆì¡´, ë§ˆì´í¬ë¡œì†Œí”„íŠ¸, ibm, intel, red hat ì„ ë‘ê¸°ì—…ë“¤ì´ ì¿ ë²„ë„¤í‹°ìŠ¤ í•˜ë‚˜ë¥¼ ê°™ì´ ë§Œë“¤ê³  ìˆìŒ. ë…¸í•˜ìš° ë° ì—…ê³„ ìµœê³ ì˜ ì•„ì´ë””ì–´ê°€ ë…¹ì•„ë“¤ì–´ ìˆìŒ</li>
<li><strong>ìë™í™”, ë…¼ë¦¬ì ì¸ ë‹¨ìœ„, ë…¸í•˜ìš°</strong></li>
<li>ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” ê·¸ë¦¬ìŠ¤ì–´ë¡œ ì¡°íƒ€ìˆ˜, ì¡°ì¢…ìˆ˜ / ì¤„ì—¬ì„œ ë§í•  ë•Œ k8s, kube íë¸Œ</li>
<li>CNCF í´ë¼ìš°ë“œ ë„¤ì´í‹°ë¸Œ<ul>
<li>í´ë¼ìš°ë“œ ì´í›„ , ìˆ˜ë§ì€ ë¦¬ì†ŒìŠ¤ë¥¼ ììœ ë¡­ê²Œ ì‚¬ìš©í•˜ê³  ì¶”ìƒì ìœ¼ë¡œ ê´€ë¦¬</li>
</ul>
</li>
</ul>
</li>
<li><p>ì¿ ë²„ë„¤í‹°ìŠ¤ ë°°í¬ ë°ëª¨</p>
<ul>
<li><p>AWS í´ë¼ìš°ë“œì— ghost ë¸”ë¡œê·¸ ë°°í¬</p>
<blockquote>
<p>kubectl get node</p>
</blockquote>
<blockquote>
<p>kubectl get namespace</p>
</blockquote>
<blockquote>
<p>kubectl get po -n NAME</p>
</blockquote>
<blockquote>
<p>helm install ghost bitmani/ghost \ </p>
</blockquote>
<p>ghostëŠ” helmì´ë¼ëŠ” íŒ¨í‚¤ì§€ë§¤ë‹ˆì €ë¥¼ ì´ìš©í•˜ì—¬ ì„¤ì¹˜</p>
<p>ë¯¸ë¦¬ ì„¤ì •í•´ë‘” valueëŒ€ë¡œ node.jsì™€ maria dbê¹Œì§€ ì„¤ì¹˜ê°€ ë¨</p>
<blockquote>
<p>kubectl get po â† ìƒíƒœí™•ì¸</p>
</blockquote>
<blockquote>
<p>kubectl describe po/ghost- â† describeë¡œ ìƒì„¸ì •ë³´ ë³´ê¸° ì–¸ì œ scheduling ë“±</p>
</blockquote>
</li>
<li><p>ì»¨í…Œì´ë„ˆê°€ ì£½ì–´ë²„ë¦¬ë©´ ìë™ìœ¼ë¡œ ë„ì›Œì£¼ëŠ” ê¸°ëŠ¥ í™•ì¸</p>
<blockquote>
<p>kubectl delete po/ghost-</p>
</blockquote>
<blockquote>
<p>kubectl get po â† ê¸°ì¡´êº¼ ëŒ€ì‹ ì— ë‹¤ë¥¸ê²Œ ë‹¤ì‹œ ëœ¸. container ochestrationì€ ìƒíƒœë¥¼ ìœ ì§€í•˜ë ¤ í•˜ê¸° ë•Œë¬¸ì— ì»¨í…Œì´ë„ˆê°€ ì£½ë”ë¼ë„ ì¿ ë²„ë„¤í‹°ìŠ¤ê°€ ìë™ìœ¼ë¡œ ë„ì›Œì¤Œ.</p>
</blockquote>
</li>
<li><p>ghost ë²„ì „ ë°”ê¾¸ê³  ì¬ë°°í¬ ì‹œ</p>
<blockquote>
<p>helm upgrade ghost bitnami/ghost \</p>
</blockquote>
<p>ê·¸ë˜ë„ ì„œë²„ê°€ ì£½ì§€ ì•Šê³  ì‚´ì•„ìˆìŒ. ì•„ê¹Œ ìƒì„±í–ˆë˜ê±´ ê·¸ëŒ€ë¡œ ëŸ¬ë‹, ìƒˆë¡œìš´ podì´ ëœ¸ . ìƒˆë¡œìš´ podì´ ì˜ ëœ¨ë©´, ê¸°ì¡´ì˜ ê²ƒì„ ì•Œì•„ì„œ ì£½ì„.</p>
</li>
<li><p>ëª¨ë‹ˆí„°ë§</p>
</li>
</ul>
</li>
<li><p>ì¿ ë²„ë„¤í‹°ìŠ¤ ì•„í‚¤í…ì²˜ (êµ¬ì„±/ì„¤ê³„)</p>
</li>
</ul>
<pre><code>- ìš”ì²­ë°›ì€ê±° ë¯¸ë¦¬ ê¸°ë¡í•´ë‘ê³ , ëª¨ë‹ˆí„°ë§ ì‹œì— ê¸°ë¡ë‚´ìš©ìœ¼ë¡œ ì‹¤ì œ ì»¨í…Œì´ë„ˆë¥¼ ë¹„êµí•˜ì—¬ ë‹¬ë¼ì¡Œì„ ê²½ìš° ìƒíƒœë¥¼ ë§ì¶¤.
- Desired State
    - í˜„ì¬ ìƒíƒœ == ì›í•˜ëŠ” ìƒíƒœ
    - **(LOOP) Observer ìƒíƒœ â†’ Diff ì°¨ì´â†’ Act ì¡°ì¹˜**
- Scheduler
    - ì»¨í…Œì´ë„ˆ ì²´í¬
- Controller ì—­í•  ë¶€ì—¬
    - ìƒíƒœ ì²´í¬
    - e.g. Replication Controller(ë³µì œset ì²´í¬), Endpoint Controller(ì„œë¹„ìŠ¤, ë¡œë“œë°¸ëŸ°ì‹± ì²´í¬), Namespace Controller, Custom Controller, ML Controller, CI/CD Controller..

- Master ì²´í¬, ì‹¤í–‰ ë¶€ë¶„
    - api server ì¤‘ê°„ êµí†µì •ë¦¬
        - ì¡°íšŒ ìš”ì²­
        - ìƒíƒœë¥¼ ë°”ê¾¸ê±°ë‚˜ ì¡°íšŒ
        - etcdì™€ ìœ ì¼í•˜ê²Œ í†µì‹ í•˜ëŠ” ëª¨ë“ˆ
        - REST APIí˜•íƒœë¡œ ì œê³µ
        - ê¶Œí•œì„ ì²´í¬í•˜ì—¬ ì ì ˆí•œ ê¶Œí•œì´ ì—†ì„ ê²½ìš° ìš”ì²­ì„ ì°¨ë‹¨
        - ê´€ë¦¬ì ìš”ì²­ ë¿ ì•„ë‹ˆë¼ ë‹¤ì–‘í•œ ë‚´ë¶€ ëª¨ë“ˆê³¼ í†µì‹ 
        - ìˆ˜í‰ìœ¼ë¡œ í™•ì¥ë˜ë„ë¡ ë””ìì¸
    - ìƒíƒœ ì €ì¥ ì¡°íšŒëŠ” etcd
        - ëª¨ë“  ìƒíƒœì™€ ë°ì´í„°ë¥¼ ì €ì¥
        - ë¶„ì‚° ì‹œìŠ¤í…œìœ¼ë¡œ êµ¬ì„±í•˜ì—¬ ì•ˆì „ì„±ì„ ë†’ì„(ê³ ê°€ìš©ì„±)
        - ê°€ë³ê³  ë¹ ë¥´ë©´ì„œ ì •í™•í•˜ê²Œ ì„¤ê³„(ì¼ê´€ì„±)
        - Key(directory)-Value í˜•íƒœë¡œ ë°ì´í„° ì €ì¥
        - TTL(time to live), watchì™€ ê°™ì€ ë¶€ê°€ ê¸°ëŠ¥ ì œê³µ
        - ë°±ì—…ì€ í•„ìˆ˜
    - Scheduler ì–´ë–¤ ë…¸ë“œì— ì–´ë–¤ ì»¨í…Œì´ë„ˆë¥¼?
        - ìƒˆë¡œ ìƒì„±ëœ Podì„ ê°ì§€í•˜ê³  ì‹¤í–‰í•  ë…¸ë“œë¥¼ ì„ íƒ
        - ë…¸ë“œì˜ í˜„ì¬ ìƒíƒœì™€ Podì˜ ìš”êµ¬ì‚¬í•­ì„ ì²´í¬
            - ë…¸ë“œì— ë¼ë²¨ì„ ë¶€ì—¬ e.g. a-zone, b-zone
    - Controller
        - ë…¼ë¦¬ì ìœ¼ë¡œ ë‹¤ì–‘í•œ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì¡´ì¬
        - ëŠì„ì—†ì´ ìƒíƒœì²´í¬, ì›í•˜ëŠ” ìƒíƒœ ìœ ì§€
        - ë³µì¡ì„± ë‚®ì¶”ê¸° ìœ„í•´ ë‹¨ì¼ í”„ë¡œì„¸ìŠ¤ë¡œ ì‹¤í–‰
    - ì¡°íšŒíë¦„
        1. ì •ë³´ì¡°íšŒ Controllerê°€ API Serverì— ë¬¼ì–´ë´„
        2. API SERVERê°€ ì •ë³´ ì¡°íšŒ ê¶Œí•œ ì²´í¬ 
        3. etcdì— ì •ë³´ì¡°íšŒë¥¼ í•´ì„œ ì•Œë ¤ì¤Œ

        1. etcdì—ëŠ” ì›í•˜ëŠ” ìƒíƒœ ë³€ê²½

        2. ì»¨íŠ¸ë¡¤ëŸ¬ì— ì›í•˜ëŠ” ìƒíƒœ ë³€ê²½

        3. ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ì›í•˜ëŠ” ìƒíƒœë¡œ ë¦¬ì†ŒìŠ¤ ë³€ê²½

        4. ë³€ê²½ì‚¬í•­ì„ api serverì— ì „ë‹¬

        5. ì •ë³´ ê°±ì‹  ê¶Œí•œ ì²´í¬

        6. etcdì— ì •ë³´ê°±ì‹ 

        â†’ ìˆ˜ë§ì€ ìŠ¤ì¼€ì¤„ëŸ¬ì™€ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ etcdì™€ ì§ì ‘í†µì‹ ì´ ì•„ë‹Œ api serverì™€ í†µì‹ í•˜ì—¬ ì „ë‹¬

- NodeëŠ” ì‹¤ì œë¡œ ì‹¤í–‰ë˜ëŠ” ë¶€ë¶„
    - Proxy
        - ë„¤íŠ¸ì›Œí¬ í”„ë¡ì‹œì™€ ë¶€í•˜ ë¶„ì‚° ì—­í• 
        - ì„±ëŠ¥ìƒ ì´ìŠˆë¡œ ë³„ë„ í”„ë¡ì‹œ í”„ë¡œê·¸ë¨ ëŒ€ì‹  iptables or IPVS ì‚¬ìš©(ì„¤ì •ë§Œ ê´€ë¦¬)
    - Kubelet ì»¨í…Œì´ë„ˆ ê´€ë¦¬ í™•ì‹¤í•˜ê²Œ podì´ë¼ëŠ” ê²ƒìœ¼ë¡œ ê°ì‹¸ì„œ
        - ê° ë…¸ë“œì—ì„œ ì‹¤í–‰
        - Podì„ ì‹¤í–‰/ì¤‘ì§€í•˜ê³  ìƒíƒœì²´í¬
        - CRI(Container Runtime Interface)
            - docker
            - Containerd
            - CRI-O

- ì¿ ë²„ë„¤í‹°ìŠ¤ íë¦„
    1. api serverì— pod ìš”ì²­
    2. etcdì— ìƒì„±ìš”ì²­
    3. controllerê°€ ìƒˆ pod í™•ì¸
    4. ì‹¤ì œ Pod í• ë‹¹ ìš”ì²­ì„ ë‹¤ì‹œ í•¨
    5. apiì„œë²„ëŠ” etcdì— pod í• ë‹¹ ìš”ì²­
    6. ìŠ¤ì¼€ì¤„ëŸ¬ëŠ” ìƒˆ pod í• ë‹¹ í™•ì¸
    7. íŠ¹ì • ë…¸ë“œì— pod í• ë‹¹
    8. apiì„œë²„ëŠ” ë‹¤ì‹œ ë°›ì•„ì„œ etcdì— ì´ podì„ íŠ¹ì • ë…¸ë“œì— í• ë‹¹ / ë¯¸ì‹¤í–‰
    9. Kubelet íë¸”ë¦¿ì´ ë¯¸ì‹¤í–‰ pod í™•ì¸
    10. pod ìƒì„±
    11. api serverê°€ pod ìƒì„± ì—…ë°ì´íŠ¸ etcd pot ì‹¤í–‰ì¤‘</code></pre><ul>
<li><p>ì¿ ë²„ë„¤í‹°ìŠ¤ <strong>ì˜¤ë¸Œì íŠ¸</strong></p>
<ul>
<li>Pod : ê°€ì¥ ì‘ì€ ë°°í¬ ë‹¨ìœ„<ul>
<li>ì»¨í…Œì´ë„ˆë¥¼ podìœ¼ë¡œ ê°ì‹¸ì„œ ë°°í¬</li>
<li>ì „ì²´ í´ëŸ¬ìŠ¤í„°ì—ì„œ ê³ ìœ í•œ IPë¥¼ í• ë‹¹  -ë‚´ë¶€ì ìœ¼ë¡œ í†µì‹  ê°€ëŠ¥</li>
<li>ì—¬ëŸ¬ê°œì˜ ì»¨í…Œì´ë„ˆê°€ í•˜ë‚˜ì˜ Podì— ì†í•  ìˆ˜ ìˆìŒ</li>
</ul>
</li>
<li>ReplicaSet : ì—¬ëŸ¬ê°œì˜ Podì„ ê´€ë¦¬<ul>
<li>replicas = 3&gt;4</li>
<li>ìƒˆë¡œìš´ Podì€ Templateì„ ì°¸ê³ í•˜ì—¬ ìƒì„±</li>
<li>ì‹ ê·œ Podì„ ìƒì„±í•˜ê±°ë‚˜ ê¸°ì¡´ Podì„ ì œê±°í•˜ì—¬ ì›í•˜ëŠ” ìˆ˜(Replicas)ë¥¼ ìœ ì§€</li>
</ul>
</li>
<li>Deployment : ë°°í¬ ë²„ì „ì„ ê´€ë¦¬. ReplicaSetì„ ê°ì‹¼ ì• <ul>
<li>replicaset ìì²´ë¥¼ í™œìš©í•´ì„œ ë²„ì „ ê´€ë¦¬</li>
</ul>
</li>
<li>ë‹¤ì–‘í•œ Workload<ul>
<li>Daemon set : ëª¨ë“  ë…¸ë“œì— ê¼­ í•˜ë‚˜ì”©ë§Œ ë– ìˆê¸¸ ì›í•˜ëŠ” podì„ ìƒì„±í•˜ê¸° ì›í•  ë•Œ, ë¡œê·¸ ìˆ˜ì§‘ ìš©ë„ ë“±</li>
<li>Stateful sets: ê°™ì€ ë³¼ë¥¨ ì¬í™œìš© ë“±</li>
<li>JOB : í•œë²ˆ ì‹¤í–‰í•˜ê³  ì£½ëŠ” pod</li>
</ul>
</li>
<li>Service<ul>
<li>ClusterIP<ul>
<li>í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì—ì„œ ì‚¬ìš©í•˜ëŠ” í”„ë¡ì‹œ</li>
<li>í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì—ì„œ ì„œë¹„ìŠ¤ ì—°ê²°ì€ DNSë¥¼ ì´ìš©</li>
</ul>
</li>
<li>NodePort<ul>
<li>ë…¸ë“œ(host)ì— ë…¸ì¶œë˜ì–´ ì™¸ë¶€ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•œ ì„œë¹„ìŠ¤</li>
<li>ëª¨ë“  ë…¸ë“œì— ë™ì¼í•œ í¬íŠ¸ë¡œ ìƒì„±</li>
</ul>
</li>
<li>LoadBalancer<ul>
<li>í•˜ë‚˜ì˜ IPì£¼ì†Œë¥¼ ì™¸ë¶€ì— ë…¸ì¶œ</li>
</ul>
</li>
</ul>
</li>
<li>Ingress<ul>
<li>ë„ë©”ì¸ ë˜ëŠ” ê²½ë¡œë³„ ë¼ìš°íŒ…<ul>
<li>Nginx, HAProxy, ALB, â€¦</li>
</ul>
</li>
</ul>
</li>
<li>ì¼ë°˜ì ì¸ êµ¬ì„± : podì„ ë„ìš°ëŠ” ê²½ìš°ëŠ” ì˜ ì—†ìŒ. Deployment ìƒì„± ì‹œ replicaSetì´ ìë™ìœ¼ë¡œ ìƒì„±ë˜ê³ , replicaSetì´ podì„ ìë™ìœ¼ë¡œ ìƒì„±í•¨. ì™¸ë¶€ë¡œ ë…¸ì¶œí•˜ê¸°ìœ„í•´ serviceë¥¼ ë¶™ì´ê³ , ingressë¥¼ ë¶™ì—¬ì„œ loadBalancerê°€ ìë™ìœ¼ë¡œ ë¶™ìŒ.</li>
<li>ì‹¤ì œ í´ë¼ì´ì–¸íŠ¸ëŠ” ì € ë„ë©”ì¸ìœ¼ë¡œ ì ‘ì†í•˜ë©´ loadBalancerë¥¼ ê±°ì³ì„œ NodePortë¥¼ ê±°ì³ì„œ clusterIpë¥¼ ê±°ì³ì„œ podìœ¼ë¡œ ì—°ê²°ë¨.</li>
<li>ê·¸ ì™¸ ê¸°ë³¸ ì˜¤ë¸Œì íŠ¸<ul>
<li>Volume - Storage(EBS, NFS, â€¦)</li>
<li>Namespace - ë…¼ë¦¬ì ì¸ ë¦¬ì†ŒìŠ¤ êµ¬ë¶„</li>
<li>ConfigMap/Secret - ì„¤ì •</li>
<li>ServiceAccount - ê¶Œí•œ ê²Œì •</li>
<li>Role/ClusterRole - ê¶Œí•œ ì„¤ì •(get, list, watch, create, â€¦)</li>
</ul>
</li>
</ul>
</li>
<li><p>ì¿ ë²„ë„¤í‹°ìŠ¤ API í˜¸ì¶œ</p>
<ul>
<li>YAML<ul>
<li>key-value í˜•ì‹ìœ¼ë¡œ ì‚¬ìš© , ëª…ì„¸ë¥¼ ì‘ì„±</li>
</ul>
</li>
<li>API í˜¸ì¶œ : ì›í•˜ëŠ” ìƒíƒœ(desired state)ë¥¼ ë‹¤ì–‘í•œ ì˜¤ë¸Œì íŠ¸(object)ë¡œ ì •ì˜(spec)í•˜ê³  APIì„œë²„ì— YAML í˜•ì‹ìœ¼ë¡œ ì „ë‹¬</li>
</ul>
</li>
</ul>
<p>#2 ì¿ ë²„ë„¤í‹°ìŠ¤ ì‹¤ìŠµ ì¤€ë¹„</p>
<p><a href="https://subicura.com/k8s/prepare/yaml.html">YAML ë¬¸ë²•</a></p>
<ul>
<li><p>YAML ì•¼ë¯ˆ ë¬¸ë²•  â†JSONê³¼ ë¹„ìŠ·</p>
<ul>
<li><p>ë“¤ì—¬ì“°ê¸°(indent) : ë“¤ì—¬ì“°ê¸°ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ 2ì¹¸(ì¶”ì²œ) ë˜ëŠ” 4ì¹¸ ì§€ì›</p>
</li>
<li><p>ë°ì´í„° ì •ì˜(map) : ë°ì´í„°ëŠ” key : value í˜•ì‹ìœ¼ë¡œ ì •ì˜</p>
<ul>
<li>keyì™€ value ì‚¬ì´ì—ëŠ” ë°˜ë“œì‹œ ë¹ˆì¹¸ì´ í•„ìš”</li>
</ul>
</li>
<li><p>ë°°ì—´ ì •ì˜(array) : ë°°ì—´ì€ - ë¡œ í‘œì‹œ</p>
</li>
<li><p>ì£¼ì„(comment) #</p>
</li>
<li><p>ì°¸/ê±°ì§“ : ture, false ì™¸ì— yes, no ì§€ì›</p>
</li>
<li><p>ìˆ«ì : ì •ìˆ˜ ë˜ëŠ” ì‹¤ìˆ˜ë¥¼ ë”°ì˜´í‘œ(â€) ì—†ì´ ì‚¬ìš©í•˜ë©´ ìˆ«ìë¡œ ì¸ì‹</p>
</li>
<li><p>ì¤„ë°”ê¿ˆ(newline)</p>
<ul>
<li>â€œ|â€ ë§ˆì§€ë§‰ ì¤„ë°”ê¿ˆì´ í¬í•¨</li>
<li>â€œ|-â€ ë§ˆì§€ë§‰ ì¤„ë°”ê¿ˆì„ ì œì™¸</li>
<li>â€œ&gt;â€ ì¤‘ê°„ì— ë“¤ì–´ê°„ ë¹ˆì¤„ì€ ì œì™¸</li>
</ul>
</li>
<li><p>ë¬¸ìì—´ ë”°ì˜´í‘œ â€œ:â€ê°€ ë“¤ì–´ê°„ ê²½ìš°ëŠ” ë°˜ë“œì‹œ ë”°ì˜´í‘œê°€ í•„ìš” â€œc:â€ or â€˜c:â€™</p>
</li>
<li><p>ì‚¬ì´íŠ¸ ì¶”ì²œ: json2yaml.com , yamllint.com</p>
<pre><code class="language-yaml">#comment
api: v1  # comment
kind: Pod
metadata:
name: echo
labels:
  type: app
skills:
  - docker
  - kubernetes
newlines_sample: |-
                      number one line

                      second line

                      last line</code></pre>
</li>
</ul>
</li>
</ul>
<h2 id="2-ì¿ ë²„ë„¤í‹°ìŠ¤-ì„¤ì¹˜-ë°-ì‹¤ìŠµ">#2 ì¿ ë²„ë„¤í‹°ìŠ¤ ì„¤ì¹˜ ë° ì‹¤ìŠµ</h2>
<p>20230516</p>
<h3 id="ì„¤ì¹˜">ì„¤ì¹˜</h3>
<p>ê°œë°œvsìš´ì˜</p>
<p>ì¿ ë²„ë„¤í‹°ìŠ¤ë¥¼ ìš´ì˜í™˜ê²½ì— ì„¤ì¹˜í•˜ê¸° ìœ„í•´ì„  ìµœì†Œ 3ëŒ€ì˜ ë§ˆìŠ¤í„° ì„œë²„ì™€ ì»¨í…Œì´ë„ˆ ë°°í¬ë¥¼ ìœ„í•œ nê°œì˜ ë…¸ë“œì„œë²„ê°€ í•„ìš”í•¨.</p>
<p>ê°œë°œí™˜ê²½ì—ì„œëŠ” ë§ˆìŠ¤í„°ì™€ ë…¸ë“œê°€ í•˜ë‚˜ì— ìˆê³  ì„¤ì¹˜ê°€ ì‰¬ìš´ docker, minikube, kind, K3S .. </p>
<p>ìš°ë¦¬ëŠ” ë¯¸ë‹ˆì¿ ë² ë¡œ ì‹¤ìŠµ</p>
<p>##minikube ë¬´ë£Œ, ê°„í¸</p>
<p>ë¯¸ë‹ˆì¿ ë² ì™€ ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ ì°¨ì´</p>
<p>ì„œë²„ê°€ ì—¬ëŸ¬ê°œì¼ë•Œ ìë™ìœ¼ë¡œ ìŠ¤ì¼€ì¤„ë§ ë˜ê³ , ë¡œë“œë°¸ëŸ°ì„œë‚˜ persistent Local Storageë¥¼ í…ŒìŠ¤íŠ¸í•˜ê¸° ì–´ë µë‹¤. </p>
<p>Mac OSì—ì„œ ë¯¸ë‹ˆì¿ ë² </p>
<pre><code>    #í™ˆë¸Œë£¨ë¡œ ë¯¸ë‹ˆì¿ ë²  ì„¤ì¹˜
    brew install minikube

    #ë²„ì „í™•ì¸
    minikube version

    #ê°€ìƒë¨¸ì‹  ì‹œì‘
    minikube start --driver=hyperkit

    ğŸ˜„  Darwin 13.3.1 (arm64) ì˜ minikube v1.30.1
    âœ¨  ìœ ì € í™˜ê²½ ì„¤ì • ì •ë³´ì— ê¸°ë°˜í•˜ì—¬ hyperkit ë“œë¼ì´ë²„ë¥¼ ì‚¬ìš©í•˜ëŠ” ì¤‘

    âŒ  Exiting due to DRV_UNSUPPORTED_OS: The driver 'hyperkit' is not supported on darwin/arm64
</code></pre><p>í•´ê²°ë°©ë²•: docker <a href="https://docs.docker.com/desktop/install/mac-install/">ì„¤ì¹˜</a></p>
<pre><code>    jMacui-iMac:~ ijaehui$ minikube start --driver=docker 
    ğŸ˜„  Darwin 13.3.1 (arm64) ì˜ minikube v1.30.1
    âœ¨  ìœ ì € í™˜ê²½ ì„¤ì • ì •ë³´ì— ê¸°ë°˜í•˜ì—¬ docker ë“œë¼ì´ë²„ë¥¼ ì‚¬ìš©í•˜ëŠ” ì¤‘
    ğŸ“Œ  Using Docker Desktop driver with root privileges
    ğŸ‘  minikube í´ëŸ¬ìŠ¤í„°ì˜ minikube ì»¨íŠ¸ë¡¤ í”Œë ˆì¸ ë…¸ë“œë¥¼ ì‹œì‘í•˜ëŠ” ì¤‘
    ğŸšœ  ë² ì´ìŠ¤ ì´ë¯¸ì§€ë¥¼ ë‹¤ìš´ë°›ëŠ” ì¤‘ ...
    ğŸ’¾  ì¿ ë²„ë„¤í‹°ìŠ¤ v1.26.3 ì„ ë‹¤ìš´ë¡œë“œ ì¤‘ ...
        &gt; preloaded-images-k8s-v18-v1...:  330.52 MiB / 330.52 MiB  100.00% 5.84 Mi
        &gt; gcr.io/k8s-minikube/kicbase...:  336.39 MiB / 336.39 MiB  100.00% 4.38 Mi
    ğŸ”¥  Creating docker container (CPUs=2, Memory=4000MB) ...
    â—  This container is having trouble accessing https://registry.k8s.io
    ğŸ’¡  To pull new external images, you may need to configure a proxy: https://minikube.sigs.k8s.io/docs/reference/networking/proxy/
    ğŸ³  ì¿ ë²„ë„¤í‹°ìŠ¤ v1.26.3 ì„ Docker 23.0.2 ëŸ°íƒ€ì„ìœ¼ë¡œ ì„¤ì¹˜í•˜ëŠ” ì¤‘
        â–ª ì¸ì¦ì„œ ë° í‚¤ë¥¼ ìƒì„±í•˜ëŠ” ì¤‘ ...
        â–ª ì»¨íŠ¸ë¡¤ í”Œë ˆì¸ì´ ë¶€íŒ…...
        â–ª RBAC ê·œì¹™ì„ êµ¬ì„±í•˜ëŠ” ì¤‘ ...
    ğŸ”—  Configuring bridge CNI (Container Networking Interface) ...
        â–ª Using image gcr.io/k8s-minikube/storage-provisioner:v5
    ğŸ”  Kubernetes êµ¬ì„± ìš”ì†Œë¥¼ í™•ì¸...
    ğŸŒŸ  ì• ë“œì˜¨ í™œì„±í™” : storage-provisioner, default-storageclass
    ğŸ„  ëë‚¬ìŠµë‹ˆë‹¤! kubectlì´ "minikube" í´ëŸ¬ìŠ¤í„°ì™€ "default" ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ê¸°ë³¸ì ìœ¼ë¡œ ì‚¬ìš©í•˜ë„ë¡ êµ¬ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.</code></pre><p>ìƒíƒœí™•ì¸</p>
<pre><code>    jMacui-iMac:~ ijaehui$ minikube status
    minikube
    type: Control Plane
    host: Running
    kubelet: Running
    apiserver: Running
    kubeconfig: Configured</code></pre><p>ì‚¬ìš©ì•ˆí•  ë• ì¤‘ì§€</p>
<pre><code>    jMacui-iMac:~ ijaehui$ minikube stop
    âœ‹  "minikube" ë…¸ë“œë¥¼ ì¤‘ì§€í•˜ëŠ” ì¤‘ ...
    ğŸ›‘  "minikube"ë¥¼ SSHë¡œ ì „ì›ì„ ë•ë‹ˆë‹¤ ...
    ğŸ›‘  1ê°œì˜ ë…¸ë“œê°€ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.</code></pre><p>ê°€ìƒë¨¸ì‹  ì ‘ì†</p>
<pre><code>&gt;minikube ssh

minikubeê°€ etcd ë“± ì•Œì•„ì„œ ë‹¤ í•´ì£¼ë„¤ 

kubectl íë¸Œì»¨íŠ¸ë¡¤ ì„¤ì¹˜ 

kubectlì€ ì¿ ë²„ë„¤í‹°ìŠ¤ CLI ë„êµ¬. ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ì— ëª…ë ¹ì–´ë¥¼ ì „ë‹¬í•˜ëŠ” ê°€ì¥ í”í•œ ë°©ë²•

í´ë¼ìš°ë“œ ìƒì˜ ê°€ìƒë¨¸ì‹  k3s

í•œë‹¬ì— $20, í•˜ë£¨ì— 1000ì› ì´í•˜ì˜ ë¹„ìš©</code></pre><h3 id="ì¿ ë²„ë„¤í‹°ìŠ¤-ì‹¤ìŠµ">ì¿ ë²„ë„¤í‹°ìŠ¤ ì‹¤ìŠµ</h3>
<pre><code>    jMacui-iMac:index ijaehui$ docker-compose down
    [+] Running 3/3
     âœ” Container index-mysql-1      Removed                                                                                            0.5s 
     âœ” Container index-wordpress-1  Removed                                                                                            1.2s 
     âœ” Network index_default        Removed                                                                                            0.1s 
    jMacui-iMac:index ijaehui$ vi wordpress-k8s.yml
    jMacui-iMac:index ijaehui$ kubectl apply -f wordpress-k8s.yml
    deployment.apps/wordpress-mysql created
    service/wordpress-mysql created
    deployment.apps/wordpress created
    service/wordpress created
    jMacui-iMac:index ijaehui$ kubectl get all
    NAME                                   READY   STATUS              RESTARTS   AGE
    pod/wordpress-bd4df79df-4c9wn          1/1     Running             0          39s
    pod/wordpress-mysql-6b9c6b459d-5wpg5   0/1     ContainerCreating   0          39s

    NAME                      TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE
    service/kubernetes        ClusterIP   10.96.0.1       &lt;none&gt;        443/TCP        34m
    service/wordpress         NodePort    10.102.94.125   &lt;none&gt;        80:**31346**/TCP   39s
    service/wordpress-mysql   ClusterIP   10.109.245.99   &lt;none&gt;        3306/TCP       39s

    NAME                              READY   UP-TO-DATE   AVAILABLE   AGE
    deployment.apps/wordpress         1/1     1            1           39s
    deployment.apps/wordpress-mysql   0/1     1            0           39s

    NAME                                         DESIRED   CURRENT   READY   AGE
    replicaset.apps/wordpress-bd4df79df          1         1         1       39s
    replicaset.apps/wordpress-mysql-6b9c6b459d   1         1         0       39s</code></pre><h4 id="docker-ì‚¬ìš©ìœ¼ë¡œ-í¬íŠ¸-ì ‘ì†-ì•ˆë -ë•Œ">docker ì‚¬ìš©ìœ¼ë¡œ í¬íŠ¸ ì ‘ì† ì•ˆë  ë•Œ</h4>
<pre><code>[**Docker DesktopÂ (opens new window)**](https://www.docker.com/products/docker-desktop)ì´ ì„¤ì¹˜ë˜ì–´ ìˆìœ¼ë©´ minikubeê°€ ê¸°ë³¸ìœ¼ë¡œÂ `docker`Â driverë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. docker ë“œë¼ì´ë¸ŒëŸ¬ë¥¼ ì‚¬ìš©í•  ê²½ìš° ì„œë¹„ìŠ¤ ë…¸ì¶œ ë°©ë²•ì…ë‹ˆë‹¤.

ìƒ˜í”Œë¡œ í…ŒìŠ¤íŠ¸í•œ wordpressì˜ ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ ë…¸ì¶œ í¬íŠ¸ëŠ” 31428ì´ì§€ë§Œ ì ‘ê·¼í•˜ê¸° ìœ„í•´ì„œëŠ”Â `minikube service`ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ê³  í”„ë¡ì‹œë¥¼ í†µí•´ ì ‘ì†í•´ì•¼ í•©ë‹ˆë‹¤.

`# ì¿ ë²„ë„¤í‹°ìŠ¤ ì„œë¹„ìŠ¤ ì´ë¦„ì´ wordpressë¼ë©´..
minikube service wordpress`</code></pre><pre><code class="language-jsx">    jMacui-iMac:index ijaehui$ minikube service wordpress
    |-----------|-----------|-------------|---------------------------|
    | NAMESPACE |   NAME    | TARGET PORT |            URL            |
    |-----------|-----------|-------------|---------------------------|
    | default   | wordpress |          80 | http://192.168.49.2:30825 |
    |-----------|-----------|-------------|---------------------------|
    ğŸƒ  wordpress ì„œë¹„ìŠ¤ì˜ í„°ë„ì„ ì‹œì‘í•˜ëŠ” ì¤‘
    |-----------|-----------|-------------|------------------------|
    | NAMESPACE |   NAME    | TARGET PORT |          URL           |
    |-----------|-----------|-------------|------------------------|
    | default   | wordpress |             | http://127.0.0.1:57038 |
    |-----------|-----------|-------------|------------------------|
    ğŸ‰  Opening service default/wordpress in default browser...
    â—  Because you are using a Docker driver on darwin, the terminal needs to be open to run it.</code></pre>
<h3 id="ê¸°ë³¸-ëª…ë ¹ì–´">ê¸°ë³¸ ëª…ë ¹ì–´</h3>
<pre><code>- ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” GUIê°€ ì—†ë‚˜ìš”? ìˆë‹¤. Lens ë¼ëŠ” í”„ë¡œê·¸ë¨

ì‹¤ì œ ê³µë¶€í• ë• ì í•© No. kubectlë¡œ í•œë•€í•œë•€ ì…ë ¥í•´ë³´ê¸°

| ëª…ë ¹ì–´ | ì„¤ëª… |
| --- | --- |
| apply | ì›í•˜ëŠ” ìƒíƒœë¥¼ ì ìš©. ë³´í†µ -f ì˜µì…˜ìœ¼ë¡œ íŒŒì¼ê³¼ í•¨ê»˜ ì‚¬ìš© |
| get | ë¦¬ì†ŒìŠ¤ ëª©ë¡ì„ ë³´ì—¬ì¤Œ |
| describe | ë¦¬ì†ŒìŠ¤ì˜ ìƒíƒœë¥¼ ìì„¸í•˜ê²Œ ë³´ì—¬ì¤Œ |
| delete | ë¦¬ì†ŒìŠ¤ ì œê±° |
| logs | ì»¨í…Œì´ë„ˆì˜ ë¡œê·¸ë¥¼ ë´„ |
| exec | ì»¨í…Œì´ë„ˆì— ëª…ë ¹ì–´ë¥¼ ì „ë‹¬. ì»¨í…Œì´ë„ˆì— ì ‘ê·¼í•  ë•Œ ì£¼ë¡œ ì‚¬ìš© |
| config | kubectl ì„¤ì •ì„ ê´€ë¦¬í•¨ |
- alias ë¡œ í¸í•˜ê²Œ ì¤„ì—¬ì“°ê¸°

```
# alias ì„¤ì •
alias k='kubectl'

# shell ì„¤ì • ì¶”ê°€
echo "alias k='kubectl'" &gt;&gt; ~/.bashrc
source ~/.bashrc
```</code></pre><h3 id="ìƒíƒœ-ì„¤ì •í•˜ê¸°-apply">ìƒíƒœ ì„¤ì •í•˜ê¸° (apply)</h3>
<p>kubectl apply -f [íŒŒì¼ëª… ë˜ëŠ” URL]</p>
<p>íŠ¹ì´í•œ ì ì€ íŒŒì¼ëª…ë¿ ì•„ë‹ˆë¼ URLë„ ì…ë ¥ì´ ê°€ëŠ¥. ì‹¤ì œë¡œ ë§ì€ ì˜ˆì œê°€ URLì„ ì œê³µ</p>
<p>ì—¬ê¸°ì„œëŠ” ì›Œë“œí”„ë ˆìŠ¤ë¥¼ ë‹¤ì‹œ ë°°í¬</p>
<pre><code># ë‹¤ì‹œ í•œë²ˆ ì›Œë“œí”„ë ˆìŠ¤ ë°°í¬í•˜ê¸° (URLë¡œ!)
kubectl apply -f https://subicura.com/k8s/code/guide/index/wordpress-k8s.yml</code></pre><h3 id="ë¦¬ì†ŒìŠ¤-ëª©ë¡ë³´ê¸°-get">ë¦¬ì†ŒìŠ¤ ëª©ë¡ë³´ê¸° (get)</h3>
<p>kubectl get [TYPE]</p>
<pre><code># Pod ì¡°íšŒ
kubectl get pod

# ì¤„ì„ë§(Shortname)ê³¼ ë³µìˆ˜í˜• ì‚¬ìš©ê°€ëŠ¥
kubectl get pods
kubectl get po

# ì—¬ëŸ¬ TYPE ì…ë ¥
kubectl get pod,service
# ì¤„ì„ë§ ë‹¤ì¤‘ ì¡°íšŒ
kubectl get po,svc

# ê°€ì¥ í”íˆ ë³´ì´ëŠ” ë¦¬ì†ŒìŠ¤ pod ,service, deployment, replicaset ,jop ì„ ë³´ì—¬ì¤Œ
kubectl get all

# ê²°ê³¼ í¬ë©§ ë³€ê²½
kubectl get pod -o wide   &lt;- ip, node ë“± ì¶”ê°€ ì •ë³´ ì¡°íšŒê°€ëŠ¥
kubectl get pod -o yaml   &lt;- ì‹¤ì œ ìƒíƒœë¥¼ ê±°ì˜ ë‹¤ ë³¼ ìˆ˜ ìˆìŒ
kubectl get pod -o json

# Label ì¡°íšŒ
kubectl get pod --show-labels</code></pre><h3 id="ë¦¬ì†ŒìŠ¤-ìƒì„¸-ìƒíƒœë³´ê¸°-describe">ë¦¬ì†ŒìŠ¤ ìƒì„¸ ìƒíƒœë³´ê¸° (describe)</h3>
<p>kubectl describe [TYPE]/[NAME] ë˜ëŠ” [TYPE] [NAME]</p>
<pre><code># Pod ì¡°íšŒë¡œ ì´ë¦„ ê²€ìƒ‰
kubectl get pod

# ì¡°íšŒí•œ ì´ë¦„ìœ¼ë¡œ ìƒì„¸ í™•ì¸
kubectl describe pod/wordpress-89dd89b6b-7rc7x  # í™˜ê²½ë§ˆë‹¤ ì´ë¦„ì´ ë‹¤ë¦…ë‹ˆë‹¤.</code></pre><h3 id="ë¦¬ì†ŒìŠ¤-ì œê±°delete">ë¦¬ì†ŒìŠ¤ ì œê±°(delete)</h3>
<pre><code>#Pod ì¡°íšŒë¡œ ì´ë¦„ ê²€ìƒ‰
kubectl get pod

# ì¡°íšŒí•œ Pod ì œê±°
kubectl delete pod/wordpress-89dd89b6b-7rc7x</code></pre><h3 id="ë¡œê·¸logs">ë¡œê·¸(logs)</h3>
<blockquote>
<p>k logs wordpress-89dd89b6b-t8t8p</p>
</blockquote>
<h3 id="ì»¨í…Œì´ë„ˆ-ëª…ë ¹ì–´-ì „ë‹¬-exec">ì»¨í…Œì´ë„ˆ ëª…ë ¹ì–´ ì „ë‹¬ (exec)</h3>
<pre><code>kubectl exec -it wordpress-89dd89b6b-t8t8p -- bash</code></pre><h3 id="ì„¤ì •-ê´€ë¦¬config">ì„¤ì • ê´€ë¦¬(config)</h3>
<pre><code># í˜„ì¬ ì»¨í…ìŠ¤íŠ¸ í™•ì¸
kubectl config current-context

# ì»¨í…ìŠ¤íŠ¸ ì„¤ì •
kubectl config use-context minikube</code></pre><h3 id="ê·¸ì™¸">ê·¸ì™¸</h3>
<pre><code># ì „ì²´ ì˜¤ë¸Œì íŠ¸ ì¢…ë¥˜ í™•ì¸
kubectl api-resources

# íŠ¹ì • ì˜¤ë¸Œì íŠ¸ ì„¤ëª… ë³´ê¸°
kubectl explain pod</code></pre><h3 id="ì›Œë“œí”„ë ˆìŠ¤-ë¦¬ì†ŒìŠ¤-ì œê±°">ì›Œë“œí”„ë ˆìŠ¤ ë¦¬ì†ŒìŠ¤ ì œê±°</h3>
<p>kubectl delete -f wordpress-k8s.yml</p>
<h1 id="pod">Pod</h1>
<p>podì€ ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ ê´€ë¦¬í•˜ëŠ” ê°€ì¥ ì‘ì€ ë°°í¬ë‹¨ìœ„</p>
<p>ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ ì–´ë–¤ ê²ƒì„ ë°°í¬í•  ë•Œ ê°€ì¥ ì‘ì€ ê²ƒ</p>
<p>ì»¨í…Œì´ë„ˆë¥¼ ë§Œë“¤ê¸´ í•˜ì§€ë§Œ podì„ í†µí•´ì„œ ì»¨í…Œì´ë„ˆë¥¼ ê´€ë¦¬í•¨. podì„ ë°°í¬, pod ì•ˆì— ì»¨í…Œì´ë„ˆê°€ ì¡´ì¬.</p>
<p>podì€ í•œê°œ ë˜ëŠ” ì—¬ëŸ¬ê°œì˜ ì»¨í…Œì´ë„ˆë¥¼ í¬í•¨í•¨</p>
<pre><code># Pod ë§Œë“¤ê¸°
kubectl run echo --image ghcr.io/subicura/echo:v1

pod/echo created

# Pod ëª©ë¡ ì¡°íšŒ
kubectl get pod

# ë‹¨ì¼ Pod ìƒì„¸ í™•ì¸
kubectl describe pod/echo

# Pod ì‚­ì œ
kubectl delete pod/echo</code></pre><h3 id="pod-ìƒì„±ê³¼ì •">pod ìƒì„±ê³¼ì •</h3>
<p>: 1.Schedulerê°€ í• ë‹¹ë˜ì§€ ì•Šì€ pod ê°ì‹œ 2.Schedulerê°€  podì„ ë…¸ë“œì— í• ë‹¹ </p>
<ol>
<li>kubeleteì´ ë…¸ë“œì— í• ë‹¹ëœ pod ê°ì‹œ 4. ì»¨í…Œì´ë„ˆ ìƒì„± 5. api serverì— podìƒíƒœ ì „ë‹¬</li>
</ol>
<p>ë¦¬ì†ŒìŠ¤ ë°°í¬ ì‹œ podì„ YAML íŒŒì¼ë¡œ ì •ì˜í•¨</p>
<pre><code>jMacui-iMac:index ijaehui$ **vi echo-pod.yml**
jMacui-iMac:index ijaehui$ k apply -f echo-pod.yml
pod/echo created
jMacui-iMac:index ijaehui$ **k get po**
NAME   READY   STATUS    RESTARTS   AGE
echo   1/1     Running   0          4s
</code></pre><h3 id="ì»¨í…Œì´ë„ˆ-ìƒíƒœ-ëª¨ë‹ˆí„°ë§">ì»¨í…Œì´ë„ˆ ìƒíƒœ ëª¨ë‹ˆí„°ë§</h3>
<ul>
<li><p>livenessProbe : ì»¨í…Œì´ë„ˆê°€ ì •ìƒë™ì‘í•˜ëŠ”ì§€ ì²´í¬í•˜ê³  ì •ìƒë™ì‘í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ <strong>ì»¨í…Œì´ë„ˆë¥¼ ì¬ì‹œì‘</strong>í•˜ì—¬ ë¬¸ì œí•´ê²°</p>
</li>
<li><p>readinessProbe : ì»¨í…Œì´ë„ˆê°€ ì¤€ë¹„ë˜ì—ˆëŠ”ì§€ ì²´í¬í•˜ê³  ì •ìƒì ìœ¼ë¡œ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ë‹¤ë©´ Podìœ¼ë¡œ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ ì œì™¸í•¨. livenessProbeì™€ ì°¨ì´ì ì€ <strong>ë¬¸ì œê°€ ìˆì–´ë„ Podì„ ì¬ì‹œì‘í•˜ì§€ ì•Šê³  ìš”ì²­ë§Œ ì œì™¸</strong>í•œë‹¤ëŠ” ì .</p>
</li>
<li><p><strong>livenessProbe + readinessProbe</strong></p>
<p>  ë³´í†µÂ <code>livenessProbe</code>ì™€Â <code>readinessProbe</code>ë¥¼ ê°™ì´ ì ìš©í•©</p>
</li>
</ul>
<h3 id="ë‹¤ì¤‘-ì»¨í…Œì´ë„ˆ">ë‹¤ì¤‘ ì»¨í…Œì´ë„ˆ</h3>
<p>ëŒ€ë¶€ë¶„Â <code>1 Pod = 1 ì»¨í…Œì´ë„ˆ</code>ì§€ë§Œ ì—¬ëŸ¬ ê°œì˜ ì»¨í…Œì´ë„ˆë¥¼ ê°€ì§„ ê²½ìš°ë„ ê½¤ í”í•¨</p>
<p>í•˜ë‚˜ì˜ Podì— ì†í•œ ì»¨í…Œì´ë„ˆëŠ” ì„œë¡œ ë„¤íŠ¸ì›Œí¬ë¥¼Â <strong>localhostë¡œ ê³µìœ í•˜ê³  ë™ì¼í•œ ë””ë ‰í† ë¦¬ë¥¼ ê³µìœ  ê°€ëŠ¥.</strong></p>
<p>ìš”ì²­íšŸìˆ˜ë¥¼ redisì— ì €ì¥í•˜ëŠ” ê°„ë‹¨í•œ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë‹¤ì¤‘ ì»¨í…Œì´ë„ˆë¡œ ìƒì„±</p>
<p><strong>í™˜ê²½ë³€ìˆ˜ ì„¤ì •</strong>í™˜ê²½ë³€ìˆ˜(env) ì •ì˜. envëŠ”Â <code>name</code>ê³¼Â <code>value</code>ë¥¼ ë³„ë„ë¡œ ì •ì˜í•¨</p>
<pre><code># ë‹¤ì¤‘ ì»¨í…Œì´ë„ˆ 

jMacui-iMac:pod ijaehui$ k exec -it counter -c app -- sh
/app # ls
Dockerfile         app.js             package-lock.json
README.md          node_modules       package.json
/app # apk add curl busybox-extras
fetch https://dl-cdn.alpinelinux.org/alpine/v3.15/main/aarch64/APKINDEX.tar.gz
fetch https://dl-cdn.alpinelinux.org/alpine/v3.15/community/aarch64/APKINDEX.tar.gz
OK: 10 MiB in 23 packages
/app # curl localhost:3000
1
/app # curl localhost:3000
2
/app # telnet locahost 6379
telnet: bad address 'locahost'
/app # telnet localhost 6379
Connected to localhost
dbsize
:1
KEYS *
*1
$5
count
GET count
$1
2
quit
+OK
Connection closed by foreign host
/app #

# ë””ë ‰í† ë¦¬ ë‚´ë¶€ pod ì‚­ì œ 

jMacui-iMac:pod ijaehui$ k delete -f ./
pod "counter" deleted
pod "echo-lp" deleted
pod "echo-health" deleted
pod "echo-rp" deleted</code></pre><p>ì‹¤ìŠµ</p>
<p><strong>ì‹¤ìŠµ1. ë‹¤ìŒ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” Podì„ ë§Œë“œì„¸ìš”.</strong></p>
<table>
<thead>
<tr>
<th>í‚¤</th>
<th>ê°’</th>
</tr>
</thead>
<tbody><tr>
<td><code>Pod ì´ë¦„</code></td>
<td>mongodb</td>
</tr>
<tr>
<td><code>Pod Label</code></td>
<td>app: mongo</td>
</tr>
<tr>
<td><code>Container ì´ë¦„</code></td>
<td>mongodb</td>
</tr>
<tr>
<td><code>Container ì´ë¯¸ì§€</code></td>
<td>mongo:4</td>
</tr>
</tbody></table>
<pre><code>apiVersion: v1
kind: Pod
metadata:
  name: mongodb
  labels:
        app: mongo
spec:
    containers:
      - name: mongodb
            image: mongo:4</code></pre><p>ok </p>
<p><strong>ì‹¤ìŠµ2. ë‹¤ìŒ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” Podì„ ë§Œë“œì„¸ìš”.</strong></p>
<table>
<thead>
<tr>
<th>í‚¤</th>
<th>ê°’</th>
</tr>
</thead>
<tbody><tr>
<td><code>Pod ì´ë¦„</code></td>
<td>mariadb</td>
</tr>
<tr>
<td><code>Pod Label</code></td>
<td>app: mariadb</td>
</tr>
<tr>
<td><code>Container ì´ë¦„</code></td>
<td>mariadb</td>
</tr>
<tr>
<td><code>Container ì´ë¯¸ì§€</code></td>
<td>mariadb:10.7</td>
</tr>
<tr>
<td><code>Container í™˜ê²½ë³€ìˆ˜</code></td>
<td>MYSQL_ROOT_PASSWORD: 123456</td>
</tr>
</tbody></table>
<pre><code>apiVersion: v1
kind: Pod
metadata:
    name: mariadb
    labels:
        app: mariadb
spec:
    containers:
        - name: mariadb
            image: mariadb:10.7
            env:
                - name: MYSQL_ROOT_PASSWORD
                    value: '123456'</code></pre><h2 id="replicaset">ReplicaSet</h2>
<p>ReplicaSetì€ ì›í•˜ëŠ” ê°œìˆ˜ì˜ Podì„ ìœ ì§€í•˜ëŠ” ì—­í• .</p>
<p>labelì„ ì´ìš©í•˜ì—¬ Podì„ ì²´í¬í•˜ê¸° ë•Œë¬¸ì— labelì´ ê²¹ì¹˜ì§€ ì•Šê²Œ ì •ì˜í•´ì•¼í•¨</p>
<p>ì‹¤ì „ì—ì„œ ReplicaSetì„ ë‹¨ë…ìœ¼ë¡œ ì“°ëŠ” ê²½ìš°ëŠ” ê±°ì˜ ì—†ìŒ. Deploymentê°€ ReplicaSetì„ ì´ìš©í•˜ê³  ì£¼ë¡œ Deploymentë¥¼ ì‚¬ìš©í•¨.</p>
<ul>
<li>guide/replicaset/echo-rs.yml</li>
</ul>
<pre><code>
apiVersion: apps/v1
kind: ReplicaSet
metadata:
  name: echo-rs
spec:
  replicas: 1
  selector:
    matchLabels:
      app: echo
      tier: app
  template:
    metadata:
      labels:
        app: echo
        tier: app
    spec:
      containers:
        - name: echo
          image: ghcr.io/subicura/echo:v1</code></pre><ul>
<li>labelsì´ ì¤‘ìš”í•¨</li>
</ul>
<pre><code># ìƒì„±ëœ podì˜ label í™•ì¸
k get po --show-labels

# ì‹¤í–‰ê²°ê³¼
NAME            READY   STATUS    RESTARTS        AGE     LABELS
echo-rs-rr47s   1/1     Running   0               16m     **app=echo,tier=app**

# ì„ì˜ë¡œ label ì œê±°
# app- ë¥¼ ì§€ì •í•˜ë©´ app labelì„ ì œê±°
kubectl label pod/echo-rs-rr47s app-

pod/echo-rs-rr47s unlabeled

jMacui-iMac:pod ijaehui$ k get po --show-labels
NAME            READY   STATUS    RESTARTS        AGE     LABELS
**echo-rs-ksxkw   1/1     Running   0               16s     app=echo,tier=app**
**echo-rs-rr47s   1/1     Running   0               18m     tier=app**

#ë‹¤ì‹œ app ì¶”ê°€
jMacui-iMac:pod ijaehui$ k label po/echo-rs-rr47s app=echo
pod/echo-rs-rr47s labeled

# ì¡°íšŒí•˜ë©´  **echo-rs-ksxkw** ì„ ì£½ì„
jMacui-iMac:pod ijaehui$ k get po --show-labels
NAME            READY   STATUS    RESTARTS        AGE     LABELS
**echo-rs-rr47s   1/1     Running   0               20m     app=echo,tier=app**
</code></pre><ul>
<li><p>ReplicaSet ì‘ë™ ë¡œì§</p>
<ol>
<li>ReplicaSet ì¡°ê±´ ì²´í¬ </li>
<li>ì¡°ê±´ì„ ë§Œì¡±í•˜ê¸° ìœ„í•´ Pod ìƒì„±, ì œê±°</li>
<li>í• ë‹¹ë˜ì§€ ì•Šì€ pod ê°ì‹œ</li>
<li>Podì„ ë…¸ë“œì— í• ë‹¹</li>
</ol>
</li>
<li><p>ReplicaSet ê°œìˆ˜ ìˆ˜ì • 1 â†’ 4</p>
<pre><code>  vi echo-rs.yml

  k apply -f echo-rs.yml
  replicaset.apps/echo-rs configured

  k get po
  NAME            READY   STATUS    RESTARTS        AGE
  echo            1/1     Running   3 (2d15h ago)   3d17h
  echo-rs-9h6m4   1/1     Running   0               6s
  echo-rs-b7hrp   1/1     Running   0               6s
  echo-rs-jkmts   1/1     Running   0               6s
  echo-rs-rr47s   1/1     Running   0               25m</code></pre></li>
</ul>
<h2 id="deployment">Deployment</h2>
<ul>
<li>echo-deployment.yml</li>
</ul>
<pre><code>apiVersion: apps/v1
**kind: Deployment**
metadata:
  **name: echo-deploy**
spec:
  replicas: 4
  selector:
    matchLabels:
      app: echo
      tier: app
  template:
    metadata:
      labels:
        app: echo
        tier: app
    spec:
      containers:
        - name: echo
          ~~image: ghcr.io/subicura/echo:v1~~
          image: ghcr.io/subicura/echo:v2</code></pre><p>DeploymentëŠ” ìƒˆë¡œìš´ ì´ë¯¸ì§€ë¡œ ì—…ë°ì´íŠ¸í•˜ê¸° ìœ„í•´ ReplicaSetì„ ì´ìš©</p>
<p>ë²„ì „ì„ ì—…ë°ì´íŠ¸í•˜ë©´ ìƒˆë¡œìš´ ReplicaSetì„ ìƒì„±í•˜ê³  í•´ë‹¹ ReplicaSetì´ ìƒˆë¡œìš´ ë²„ì „ì˜ Podì„ ìƒì„±</p>
<p>deployment ë²„ì „ê´€ë¦¬</p>
<p>ReplicaSet(v1) : replicaSet = 4 , ReplicaSet(v2) : replicaSet = 0</p>
<p>ReplicaSet(v1) : replicaSet = 3 , ReplicaSet(v2) : replicaSet = 1</p>
<p>ReplicaSet(v1) : replicaSet = 2 , ReplicaSet(v2) : replicaSet = 2</p>
<p>ReplicaSet(v1) : replicaSet = 1 , ReplicaSet(v2) : replicaSet = 3</p>
<p>ReplicaSet(v1) : replicaSet = 0 , ReplicaSet(v2) : replicaSet = 4</p>
<pre><code># deployment ê°€ ReplicaSetì„ ì¡°ì •
jMacui-iMac:pod ijaehui$ k describe deploy/echo-deploy
Name:                   echo-deploy
Namespace:              default
CreationTimestamp:      Mon, 22 May 2023 10:48:11 +0900
Labels:                 &lt;none&gt;
Annotations:            deployment.kubernetes.io/revision: 2
Selector:               app=echo,tier=app
Replicas:               4 desired | 4 updated | 4 total | 4 available | 0 unavailable
StrategyType:           RollingUpdate
MinReadySeconds:        0
RollingUpdateStrategy:  25% max unavailable, 25% max surge
Pod Template:
  Labels:  app=echo
           tier=app
  Containers:
   echo:
    Image:        ghcr.io/subicura/echo:v2
    Port:         &lt;none&gt;
    Host Port:    &lt;none&gt;
    Environment:  &lt;none&gt;
    Mounts:       &lt;none&gt;
  Volumes:        &lt;none&gt;
Conditions:
  Type           Status  Reason
  ----           ------  ------
  Available      True    MinimumReplicasAvailable
  Progressing    True    NewReplicaSetAvailable
OldReplicaSets:  echo-deploy-86b9d46884 (0/0 replicas created)
NewReplicaSet:   echo-deploy-7b549bc55c (4/4 replicas created)
Events:
  Type    Reason             Age    From                   Message
  ----    ------             ----   ----                   -------
  Normal  ScalingReplicaSet  9m30s  deployment-controller  Scaled up replica set echo-deploy-86b9d46884 to 4
  Normal  ScalingReplicaSet  4m53s  deployment-controller  Scaled up replica set echo-deploy-7b549bc55c to 1
  Normal  ScalingReplicaSet  4m53s  deployment-controller  Scaled down replica set echo-deploy-86b9d46884 to 3 from 4
  Normal  ScalingReplicaSet  4m53s  deployment-controller  Scaled up replica set echo-deploy-7b549bc55c to 2 from 1
  Normal  ScalingReplicaSet  4m11s  deployment-controller  Scaled down replica set echo-deploy-86b9d46884 to 2 from 3
  Normal  ScalingReplicaSet  4m11s  deployment-controller  Scaled up replica set echo-deploy-7b549bc55c to 3 from 2
  Normal  ScalingReplicaSet  4m10s  deployment-controller  Scaled down replica set echo-deploy-86b9d46884 to 1 from 2
  Normal  ScalingReplicaSet  4m10s  deployment-controller  Scaled up replica set echo-deploy-7b549bc55c to 4 from 3
  Normal  ScalingReplicaSet  4m10s  deployment-controller  Scaled down replica set echo-deploy-86b9d46884 to 0 from 1</code></pre><ul>
<li>deployment ì‘ë™ë¡œì§<ol>
<li>deployment ê°€ ì›í•˜ëŠ” ë°°í¬ìƒíƒœì²´í¬</li>
<li>ì¡°ê±´ì— ë§ëŠ” ReplicaSet ìƒì„±</li>
<li>ReplicaSet ì¡°ê±´ ì²´í¬</li>
<li>ì¡°ê±´ì„ ë§Œì¡±í•˜ê¸° ìœ„í•´ Pod ìƒì„±, ì œê±°</li>
<li>Schedulerê°€ í• ë‹¹ë˜ì§€ ì•Šì€ Pod ê°ì‹œ</li>
<li>Podì„ ë…¸ë“œì— í• ë‹¹</li>
</ol>
</li>
</ul>
<h3 id="ë²„ì „ê´€ë¦¬">ë²„ì „ê´€ë¦¬</h3>
<ul>
<li>ë³€ê²½ëœ ìƒíƒœë¥¼ ê¸°ë¡í•¨</li>
</ul>
<pre><code># íˆìŠ¤í† ë¦¬ í™•ì¸
kubectl rollout history deploy/echo-deploy

# revision 1 íˆìŠ¤í† ë¦¬ ìƒì„¸ í™•ì¸
kubectl rollout history deploy/echo-deploy --revision=1

# ë°”ë¡œ ì „ìœ¼ë¡œ ë¡¤ë°±
kubectl rollout undo deploy/echo-deploy

# íŠ¹ì • ë²„ì „ìœ¼ë¡œ ë¡¤ë°±
kubectl rollout undo deploy/echo-deploy --to-revision=2</code></pre><h3 id="ë°°í¬-ì „ëµ-ì„¤ì •">ë°°í¬ ì „ëµ ì„¤ì •</h3>
<ul>
<li>ë‹¤ì–‘í•œ ë°©ì‹ì˜ ë°°í¬ ì „ëµ</li>
<li>echo-deployment.yml</li>
</ul>
<pre><code>apiVersion: apps/v1
kind: Deployment
metadata:
  name: echo-deploy-st
spec:
  replicas: 4
  selector:
    matchLabels:
      app: echo
      tier: app
  **minReadySeconds: 5
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 3
      maxUnavailable: 3**
  template:
    metadata:
      labels:
        app: echo
        tier: app
    spec:
      containers:
        - name: echo
          image: ghcr.io/subicura/echo:v1
          livenessProbe:
            httpGet:
              path: /
              port: 3000</code></pre><pre><code>jMacui-iMac:pod ijaehui$ vi echo-deployment.yml
jMacui-iMac:pod ijaehui$ k apply -f echo-deployment.yml
deployment.apps/echo-deploy configured
jMacui-iMac:pod ijaehui$ k get all
NAME                               READY   STATUS    RESTARTS        AGE
pod/echo                           1/1     Running   3 (2d18h ago)   3d19h
pod/echo-deploy-7b549bc55c-6g9jd   1/1     Running   0               11s
pod/echo-deploy-7b549bc55c-7dq5x   1/1     Running   0               11s
pod/echo-deploy-7b549bc55c-bkkp6   1/1     Running   0               11s
pod/echo-deploy-7b549bc55c-xmzwn   1/1     Running   0               11s

NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
service/kubernetes   ClusterIP   10.96.0.1    &lt;none&gt;        443/TCP   6d

NAME                          READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/echo-deploy   4/4     4            4           76m

NAME                                     DESIRED   CURRENT   READY   AGE
replicaset.apps/echo-deploy-7b549bc55c   4         4         4       72m
replicaset.apps/echo-deploy-86b9d46884   0         0         0       76m
jMacui-iMac:pod ijaehui$ k get rs -w
NAME                     DESIRED   CURRENT   READY   AGE
echo-deploy-7b549bc55c   4         4         4       72m
echo-deploy-86b9d46884   0         0         0       77m
^CjMacui-iMac:pod ijaehui$ vi echo-deployment.yml
jMacui-iMac:pod ijaehui$ k apply -f echo-deployment.yml
deployment.apps/echo-deploy configured
jMacui-iMac:pod ijaehui$ k get rs -w
NAME                     DESIRED   CURRENT   READY   AGE
echo-deploy-7b549bc55c   1         1         1       73m
echo-deploy-86b9d46884   4         4         1       78m
echo-deploy-86b9d46884   4         4         2       78m
echo-deploy-86b9d46884   4         4         3       78m
echo-deploy-86b9d46884   4         4         4       78m
echo-deploy-86b9d46884   4         4         4       78m
echo-deploy-7b549bc55c   0         1         1       73m
echo-deploy-7b549bc55c   0         1         1       73m
echo-deploy-7b549bc55c   0         0         0       73m
^CjMacui-iMac:pod ijaehuivi echo-deployment.yml</code></pre><h2 id="deployment-ë¬¸ì œ">Deployment <strong>ë¬¸ì œ</strong></h2>
<p><strong>ë¬¸ì œ1. ë‹¤ìŒ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” Deploymentë¥¼ ë§Œë“œì„¸ìš”.</strong></p>
<table>
<thead>
<tr>
<th>í‚¤</th>
<th>ê°’</th>
</tr>
</thead>
<tbody><tr>
<td><code>Deployment ì´ë¦„</code></td>
<td>nginx</td>
</tr>
<tr>
<td><code>Deployment Label</code></td>
<td>app: nginx</td>
</tr>
<tr>
<td><code>Deployment ë³µì œìˆ˜</code></td>
<td>3</td>
</tr>
<tr>
<td><code>Container ì´ë¦„</code></td>
<td>nginx</td>
</tr>
<tr>
<td><code>Container ì´ë¯¸ì§€</code></td>
<td>nginx:1.14.2</td>
</tr>
</tbody></table>
<p><strong>ë¬¸ì œ2. ë³µì œê°œìˆ˜ë¥¼ 5ë¡œ ì¡°ì •í•©ë‹ˆë‹¤</strong></p>
<p><strong>ë¬¸ì œ3. ì´ë¯¸ì§€ë¥¼ nginx:1.19.5ë¡œ ë³€ê²½í•©ë‹ˆë‹¤</strong></p>
<p><strong>ë‹µ ì‘ì„±.</strong></p>
<pre><code>apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx
spec:
  ~~replicas: 3~~
  replicas: 5
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
        - name: nginx
          ~~image: nginx:1.14.2~~
          image: nginx:1.19.5</code></pre><h2 id="service">Service</h2>
<p>Podì€ ê³ ìœ í•œ ipë¥¼ ê°€ì§€ê³  ë‹¤ë¥¸ Podê³¼ í†µì‹ ê°€ëŠ¥. ì‰½ê²Œ ì‚¬ë¼ì§€ê³  ìƒì„±ë˜ëŠ” íŠ¹ì§•ë•Œë¬¸ì— ì§ì ‘ í†µì‹ í•˜ëŠ” ë°©ë²•ì€ ê¶Œì¥í•˜ì§€ ì•ŠìŒ.</p>
<p>ì¿ ë²„ë„¤í‹°ìŠ¤í‹‘ ë³„ë„ì˜ ê³ ì •ëœ ipë¥¼ ê°€ì§„ ì„œë¹„ìŠ¤ë¥¼ ë§Œë“¤ê³  ê·¸ ì„œë¹„ìŠ¤ë¥¼ í†µí•´ Podì— ì ‘ê·¼í•˜ëŠ” ë°©ì‹ ì‚¬ìš©</p>
<h3 id="serviceclusterip-ë§Œë“¤ê¸°">Service(ClusterIP) ë§Œë“¤ê¸°</h3>
<p>ClusterIPëŠ” í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì— ìƒˆë¡œìš´ IPë¥¼ í• ë‹¹í•˜ê³  ì—¬ëŸ¬ ê°œì˜ Podì„ ë°”ë¼ë³´ëŠ” ë¡œë“œë°¸ëŸ°ì„œ ê¸°ëŠ¥ì„ ì œê³µí•¨.</p>
<p>ì„œë¹„ìŠ¤ ì´ë¦„ì„ ë‚´ë¶€ ë„ë©”ì¸ ì„œë²„ì— ë“±ë¡í•˜ì—¬ Pod ê°„ì— ì„œë¹„ìŠ¤ ì´ë¦„ìœ¼ë¡œ í†µì‹ í•  ìˆ˜ ìˆìŒ.</p>
<p>ClusterIP ì„œë¹„ìŠ¤ì˜ ì„¤ì •</p>
<table>
<thead>
<tr>
<th>ì •ì˜</th>
<th>ì„¤ëª…</th>
</tr>
</thead>
<tbody><tr>
<td><code>spec.ports.port</code></td>
<td>ì„œë¹„ìŠ¤ê°€ ìƒì„±í•  Port</td>
</tr>
<tr>
<td><code>spec.ports.targetPort</code></td>
<td>ì„œë¹„ìŠ¤ê°€ ì ‘ê·¼í•  Podì˜ Port (ê¸°ë³¸: portë‘ ë™ì¼)</td>
</tr>
<tr>
<td><code>spec.selector</code></td>
<td>ì„œë¹„ìŠ¤ê°€ ì ‘ê·¼í•  Podì˜ label ì¡°ê±´</td>
</tr>
</tbody></table>
<pre><code>k apply -f counter-app.yml

# counter app ì— ì ‘ê·¼
k get po
k exec -it counter-&lt;xxxxx&gt; -- sh

# apk add curl busybox-extras #install talnet
# curl localhost:3000
# curl localhost:3000
#telnet redis 6379
  dbsize
  KEYS *
  GET count
  quit

jMacui-iMac:service ijaehui$ **k exec -it counter-587b8d775-lvdt7 -- sh**

/app # **apk add curl busybox-extras**
fetch https://dl-cdn.alpinelinux.org/alpine/v3.15/main/aarch64/APKINDEX.tar.gz
fetch https://dl-cdn.alpinelinux.org/alpine/v3.15/community/aarch64/APKINDEX.tar.gz
OK: 10 MiB in 23 packages

/app # **curl localhost:3000**
1
/app # **curl localhost:3000**
2
/app # **telnet redis 6379**
Connected to redis

**dbsize**
:1

**KEYS ***
*1
$5

**GET count**
$1
2
</code></pre><ul>
<li><p>ì„œë¹„ìŠ¤ ë™ì‘ ë¡œì§</p>
<ol>
<li>Endpoint Controller ê°€ Service ê°ì‹œ</li>
<li>Endpoint ìƒì„±</li>
<li>Kube-Proxyê°€ Endpoint ê°ì‹œ  kube-ProxyëŠ” ê° nodeì— ì„¤ì¹˜ë˜ì–´ ìˆìŒ.  Endpoint ë³€ê²½ ì‹œ iptables ì„¤ì •</li>
<li>CoreDNSê°€ Service ê°ì‹œ. Domain Name Sevice</li>
</ol>
</li>
<li><p>Endpoint ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ ë¦¬ì†ŒìŠ¤ ì¤‘ í•˜ë‚˜ ep</p>
</li>
</ul>
<pre><code>jMacui-iMac:service ijaehui$ k get endpoints
NAME         ENDPOINTS           AGE
kubernetes   192.168.49.2:8443   6d5h
redis        10.244.0.61:6379    63m
jMacui-iMac:service ijaehui$ k describe ep/redis
Name:         redis
Namespace:    default
Labels:       &lt;none&gt;
Annotations:  endpoints.kubernetes.io/last-change-trigger-time: 2023-05-22T06:54:22Z
Subsets:
  Addresses:          **10.244.0.61**
  NotReadyAddresses:  &lt;none&gt;
  Ports:
    Name     Port  Protocol
    ----     ----  --------
    &lt;unset&gt;  6379  TCP

Events:  &lt;none&gt;
jMacui-iMac:service ijaehui$ k get po
NAME                           READY   STATUS    RESTARTS        AGE
counter-587b8d775-lvdt7        1/1     Running   0               56m
echo                           1/1     Running   3 (2d22h ago)   4d
echo-deploy-86b9d46884-f2rtl   1/1     Running   0               4h52m
echo-deploy-86b9d46884-gl62c   1/1     Running   0               4h52m
echo-deploy-86b9d46884-w4879   1/1     Running   0               4h52m
echo-deploy-86b9d46884-w7rkh   1/1     Running   0               4h52m
redis-69cdf76f59-7f2nj         1/1     Running   0               64m
jMacui-iMac:service ijaehui$ k get po -o wide
NAME                           READY   STATUS    RESTARTS        AGE     IP            NODE       NOMINATED NODE   READINESS GATES
counter-587b8d775-lvdt7        1/1     Running   0               56m     10.244.0.62   minikube   &lt;none&gt;           &lt;none&gt;
echo                           1/1     Running   3 (2d22h ago)   4d      10.244.0.26   minikube   &lt;none&gt;           &lt;none&gt;
echo-deploy-86b9d46884-f2rtl   1/1     Running   0               4h52m   10.244.0.58   minikube   &lt;none&gt;           &lt;none&gt;
echo-deploy-86b9d46884-gl62c   1/1     Running   0               4h52m   10.244.0.59   minikube   &lt;none&gt;           &lt;none&gt;
echo-deploy-86b9d46884-w4879   1/1     Running   0               4h52m   10.244.0.60   minikube   &lt;none&gt;           &lt;none&gt;
echo-deploy-86b9d46884-w7rkh   1/1     Running   0               4h52m   10.244.0.57   minikube   &lt;none&gt;           &lt;none&gt;
redis-69cdf76f59-7f2nj         1/1     Running   0               64m     **10.244.0.61**   minikube   &lt;none&gt;           &lt;none&gt;
</code></pre><h3 id="servicenodeport-ë§Œë“¤ê¸°">Service(NodePort) ë§Œë“¤ê¸°</h3>
<p>ClusterIPëŠ” í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì—ì„œë§Œ ì ‘ê·¼ê°€ëŠ¥. ì‹¤ì œë¡  ë°–ì—ì„œ ì ‘ì†í•´ì•¼í•˜ë¯€ë¡œ, ë°–ì—ì„œ ì ‘ì†í•˜ëŠ” ë°©ë²• ì•Œì•„ë³´ê¸°</p>
<p>í´ëŸ¬ìŠ¤í„° ì™¸ë¶€(ë…¸ë“œ)ì—ì„œ ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ NodePort ì„œë¹„ìŠ¤ ë§Œë“¤ì–´ë³´ê¸°</p>
<ul>
<li>í´ëŸ¬ìŠ¤í„° ì™¸ë¶€ì—ì„œ ì ‘ì†</li>
</ul>
<pre><code>jMacui-iMac:service ijaehui$ cat counter-nodeport.yml
apiVersion: v1
kind: Service
metadata:
  name: counter-np
spec:
  type: NodePort
  ports:
    - port: 3000
      protocol: TCP
      nodePort: 31000
  selector:
    app: counter
    tier: app
jMacui-iMac:service ijaehui$ k apply -f counter-nodeport.yml
service/counter-np created
jMacui-iMac:service ijaehui$ k get svc
NAME         TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)          AGE
counter-np   NodePort    10.98.5.200   &lt;none&gt;        3000:31000/TCP   5s
kubernetes   ClusterIP   10.96.0.1     &lt;none&gt;        443/TCP          6d5h
redis        ClusterIP   10.99.83.25   &lt;none&gt;        6379/TCP         68m
jMacui-iMac:service ijaehui$ minikube ip
192.168.49.2
jMacui-iMac:service ijaehui$ minikube service counter-np
|-----------|------------|-------------|---------------------------|
| NAMESPACE |    NAME    | TARGET PORT |            URL            |
|-----------|------------|-------------|---------------------------|
| default   | counter-np |        3000 | http://192.168.49.2:31000 |
|-----------|------------|-------------|---------------------------|
ğŸƒ  counter-np ì„œë¹„ìŠ¤ì˜ í„°ë„ì„ ì‹œì‘í•˜ëŠ” ì¤‘
|-----------|------------|-------------|------------------------|
| NAMESPACE |    NAME    | TARGET PORT |          URL           |
|-----------|------------|-------------|------------------------|
| default   | counter-np |             | **http://127.0.0.1:52771** |
|-----------|------------|-------------|------------------------|
ğŸ‰  Opening service default/counter-np in default browser...
â—  Because you are using a Docker driver on darwin, the terminal needs to be open to run it.</code></pre><ul>
<li>NodePortëŠ” í´ëŸ¬ìŠ¤í„°ì˜ ëª¨ë“  ë…¸ë“œì— í¬íŠ¸ë¥¼ ì˜¤í”ˆí•¨. ì—¬ëŸ¬ê°œì˜ ë…¸ë“œê°€ ìˆë‹¤ë©´ ì•„ë¬´ ë…¸ë“œë¡œ ì ‘ê·¼í•´ë„ ì§€ì •í•œ Podìœ¼ë¡œ ì˜ì˜¥ ì ‘ê·¼ê°€ëŠ¥</li>
</ul>
<h3 id="serviceloadbalancer-ë§Œë“¤ê¸°">Service(LoadBalancer) ë§Œë“¤ê¸°</h3>
<pre><code>jMacui-iMac:service ijaehui$ k apply -f counter-lb.yml
service/counter-lb created

jMacui-iMac:service ijaehui$ k get svc
NAME         TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)           AGE
counter-lb   LoadBalancer   10.111.109.248   &lt;pending&gt;     30000:31910/TCP   10s
counter-np   NodePort       10.98.5.200      &lt;none&gt;        3000:31000/TCP    23h
kubernetes   ClusterIP      10.96.0.1        &lt;none&gt;        443/TCP           7d4h
redis        ClusterIP      10.99.83.25      &lt;none&gt;        6379/TCP          24h

jMacui-iMac:service ijaehui$ minikube addons enable metallb
â—  metallb is a 3rd party addon and is not maintained or verified by minikube maintainers, enable at your own risk.
â—  metallb does not currently have an associated maintainer.
â–ª Using image [quay.io/metallb/speaker:v0.9.6](http://quay.io/metallb/speaker:v0.9.6)
â–ª Using image [quay.io/metallb/controller:v0.9.6](http://quay.io/metallb/controller:v0.9.6)
ğŸŒŸ  'metallb' ì• ë“œì˜¨ì´ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤

jMacui-iMac:service ijaehui$ vi metallb-cm.yml

jMacui-iMac:service ijaehui$ k apply -f metallb-cm.yml
configmap/config configured

jMacui-iMac:service ijaehui$ k get svc
NAME         TYPE           CLUSTER-IP       EXTERNAL-IP    PORT(S)           AGE
counter-lb   LoadBalancer   10.111.109.248   **192.168.64.9**   30000:31910/TCP   3m
counter-np   NodePort       10.98.5.200      &lt;none&gt;         3000:31000/TCP    23h
kubernetes   ClusterIP      10.96.0.1        &lt;none&gt;         443/TCP           7d4h
redis        ClusterIP      10.99.83.25      &lt;none&gt;         6379/TCP          24h

jMacui-iMac:service ijaehui$ **minikube service counter-lb**
|-----------|------------|-------------|---------------------------|
| NAMESPACE |    NAME    | TARGET PORT |            URL            |
|-----------|------------|-------------|---------------------------|
| default   | counter-lb |       30000 | http://192.168.49.2:31910 |
|-----------|------------|-------------|---------------------------|
ğŸƒ  counter-lb ì„œë¹„ìŠ¤ì˜ í„°ë„ì„ ì‹œì‘í•˜ëŠ” ì¤‘
|-----------|------------|-------------|------------------------|
| NAMESPACE |    NAME    | TARGET PORT |          URL           |
|-----------|------------|-------------|------------------------|
| default   | counter-lb |             | **http://127.0.0.1:56844** |
|-----------|------------|-------------|------------------------|
ğŸ‰  Opening service default/counter-lb in default browser...
â—  Because you are using a Docker driver on darwin, the terminal needs to be open to run it.</code></pre><p>ë…¸ë“œí¬íŠ¸ë³´ë‹¤ëŠ” ë¡œë“œë°¸ëŸ°ì„œë¥¼ ì´ìš©í•¨. </p>
<p>ë¡œë“œë°¸ëŸ°ì„œ ë¬¸ì œ : í•˜ë‚˜ì˜ ì„œë¹„ìŠ¤ë§Œ ë°”ë¼ë´„</p>
<p><strong>ë¬¸ì œ1. echo ì„œë¹„ìŠ¤ë¥¼ NodePortë¡œ 32000 í¬íŠ¸ë¡œ ì˜¤í”ˆí•©ë‹ˆë‹¤.</strong></p>
<table>
<thead>
<tr>
<th>í‚¤</th>
<th>ê°’</th>
</tr>
</thead>
<tbody><tr>
<td><code>Deployment ì´ë¦„</code></td>
<td>echo</td>
</tr>
<tr>
<td><code>Deployment Label</code></td>
<td>app: echo</td>
</tr>
<tr>
<td><code>Deployment ë³µì œìˆ˜</code></td>
<td>3</td>
</tr>
<tr>
<td><code>Container ì´ë¦„</code></td>
<td>echo</td>
</tr>
<tr>
<td><code>Container ì´ë¯¸ì§€</code></td>
<td>ghcr.io/subicura/echo:v1</td>
</tr>
<tr>
<td><code>NodePort ì´ë¦„</code></td>
<td>echo</td>
</tr>
<tr>
<td><code>NodePort Port</code></td>
<td>3000</td>
</tr>
<tr>
<td><code>NodePort NodePort</code></td>
<td>32000</td>
</tr>
</tbody></table>
<p><strong>ë‹µ ì‘ì„±.</strong></p>
<pre><code>apiVersion: apps/v1
kind: Deployment
metadata:
    name: echo
spec:
    replicas: 3
    selector:
        matchLabels:
            app: echo
    template:
        metadata:
            labels:
                app: echo
        spec:
            containers:
                - name: echo
                    image: ghcr.io/subicura/echo:v1
---
apiVersion: v1
kind: Service
metadata: 
    name: echo
spec:
    type: NodePort
    ports:
        - port: 3000
            protocol: TCP
            nodePort: 32000
    selector:
        app: echo
</code></pre><h2 id="ì›Œë“œí”„ë ˆìŠ¤-ë°°í¬">ì›Œë“œí”„ë ˆìŠ¤ ë°°í¬</h2>
<pre><code>jMacui-iMac:guide ijaehui$ k apply -f wordpress.yml &lt;- ë°°í¬
deployment.apps/wordpress-mysql created
service/wordpress-mysql unchanged
deployment.apps/wordpress unchanged
service/wordpress unchanged
jMacui-iMac:guide ijaehui$  k get all &lt;-í™•ì¸
NAME                                  READY   STATUS    RESTARTS      AGE
pod/counter-587b8d775-lvdt7           1/1     Running   1 (23h ago)   24h
pod/echo                              1/1     Running   4 (23h ago)   5d
pod/echo-deploy-86b9d46884-f2rtl      1/1     Running   1 (23h ago)   28h
pod/echo-deploy-86b9d46884-gl62c      1/1     Running   1 (23h ago)   28h
pod/echo-deploy-86b9d46884-w4879      1/1     Running   1 (23h ago)   28h
pod/echo-deploy-86b9d46884-w7rkh      1/1     Running   1 (23h ago)   28h
pod/redis-69cdf76f59-7f2nj            1/1     Running   1 (23h ago)   24h
pod/wordpress-89dd89b6b-t74vm         1/1     Running   0             2m39s
pod/wordpress-mysql-87dbc78dc-ljdg9   1/1     Running   0             37s

NAME                      TYPE           CLUSTER-IP       EXTERNAL-IP    PORT(S)           AGE
service/counter-lb        LoadBalancer   10.111.109.248   192.168.64.9   30000:31910/TCP   41m
service/counter-np        NodePort       10.98.5.200      &lt;none&gt;         3000:31000/TCP    23h
service/kubernetes        ClusterIP      10.96.0.1        &lt;none&gt;         443/TCP           7d4h
service/redis             ClusterIP      10.99.83.25      &lt;none&gt;         6379/TCP          24h
service/wordpress         NodePort       10.107.167.147   &lt;none&gt;         80:30000/TCP      2m39s
service/wordpress-mysql   ClusterIP      10.109.107.143   &lt;none&gt;         3306/TCP          2m39s

NAME                              READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/counter           1/1     1            1           24h
deployment.apps/echo-deploy       4/4     4            4           29h
deployment.apps/redis             1/1     1            1           24h
deployment.apps/wordpress         1/1     1            1           2m39s
deployment.apps/wordpress-mysql   1/1     1            1           37s

NAME                                        DESIRED   CURRENT   READY   AGE
replicaset.apps/counter-587b8d775           1         1         1       24h
replicaset.apps/echo-deploy-7b549bc55c      0         0         0       29h
replicaset.apps/echo-deploy-86b9d46884      4         4         4       29h
replicaset.apps/redis-69cdf76f59            1         1         1       24h
replicaset.apps/wordpress-89dd89b6b         1         1         1       2m39s
replicaset.apps/wordpress-mysql-87dbc78dc   1         1         1       37s
jMacui-iMac:guide ijaehui$ minikube service wordpress
|-----------|-----------|-------------|---------------------------|
| NAMESPACE |   NAME    | TARGET PORT |            URL            |
|-----------|-----------|-------------|---------------------------|
| default   | wordpress |          80 | http://192.168.49.2:30000 |
|-----------|-----------|-------------|---------------------------|
ğŸƒ  wordpress ì„œë¹„ìŠ¤ì˜ í„°ë„ì„ ì‹œì‘í•˜ëŠ” ì¤‘
|-----------|-----------|-------------|------------------------|
| NAMESPACE |   NAME    | TARGET PORT |          URL           |
|-----------|-----------|-------------|------------------------|
| default   | wordpress |             | http://127.0.0.1:51529 |
|-----------|-----------|-------------|------------------------|
ğŸ‰  Opening service default/wordpress in default browser...
â—  Because you are using a Docker driver on darwin, the terminal needs to be open to run it.</code></pre><p>ì´ deploymentëŠ” 5ê°œ í•„ìš” (vote, redis, worker, db, result)</p>
<p>nodePort ServiceëŠ” 2ê°œ (íˆ¬í‘œí•œ í™”ë©´, ê²°ê³¼ë³´ëŠ” í™”ë©´)</p>
<p>ë‚´ë¶€ ì˜¤í”ˆ ì„œë¹„ìŠ¤ ClusterIP Service í•„ìš”(redis, db)</p>
<p>workerëŠ” port ì ‘ì† í•„ìš” x ìŠ¤ìŠ¤ë¡œ redisì— ì ‘ì†í•´ì„œ dbì— ì „ë‹¬í•˜ê¸° ë•Œë¬¸</p>
<h2 id="ingress">Ingress</h2>
<p>portëŠ” í•˜ë‚˜ë§Œ ì˜¤í”ˆí•˜ê³  ë„ë©”ì¸ì´ë‚˜ pathì— ë”°ë¼ì„œ serviceë¥¼ ë¶„ê¸°í•´ì¤Œ</p>
<h3 id="ingress-ìƒì„±íë¦„">ingress ìƒì„±íë¦„</h3>
<ol>
<li>Ingress Controller ëŠ” Ingress ë³€í™”ë¥¼ ì²´í¬</li>
<li>Ingress Controller ëŠ” ë³€ê²½ëœ ë‚´ìš©ì„ Nginxì— ì„¤ì •í•˜ê³  í”„ë¡œì„¸ìŠ¤ ì¬ì‹œì‘</li>
</ol>
<p><strong>ë¬¸ì œ1. ë‹¤ìŒ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” Ingressë¥¼ ë§Œë“œì„¸ìš”.</strong></p>
<table>
<thead>
<tr>
<th>í‚¤</th>
<th>ê°’</th>
</tr>
</thead>
<tbody><tr>
<td>Deployment ì´ë¦„</td>
<td>nginx</td>
</tr>
<tr>
<td>Deployment Label</td>
<td>app: nginx</td>
</tr>
<tr>
<td>Deployment ë³µì œìˆ˜</td>
<td>3</td>
</tr>
<tr>
<td>Container ì´ë¦„</td>
<td>nginx</td>
</tr>
<tr>
<td>Container ì´ë¯¸ì§€</td>
<td>nginx:latest</td>
</tr>
<tr>
<td>Ingress ë„ë©”ì¸</td>
<td>nginx.xxx.sslip.io</td>
</tr>
</tbody></table>
<p><strong>ë‹µ ì‘ì„±.</strong></p>
<pre><code>apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx
spec:
  replicaSet: 3
  selector:
    matchLables:
      app: nginx
    template:
      metadata:
        labels:
          app: nginx
      spec:
        containers:
          - name: nginx
            images: nginx:latest
---
apiVersion: v1
kind: Ingress
metadata:
  name: nginx-v1
spec:
  rules:
    - host: nginx.xxx.sslip.io   </code></pre><ul>
<li><p><strong>ì •ë‹µ.</strong></p>
<pre><code>  apiVersion: networking.k8s.io/v1
  kind: Ingress
  metadata:
    name: nginx
  spec:
    rules:
      - host: nginx.192.168.64.5.sslip.io
        http:
          paths:
            - path: /
              pathType: Prefix
              backend:
                service:
                  name: nginx
                  port:
                    number: 80

  ---
  apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: nginx
  spec:
    replicas: 3
    selector:
      matchLabels:
        app: nginx
    template:
      metadata:
        labels:
          app: nginx
      spec:
        containers:
          - name: echo
            image: nginx:latest

  ---
  apiVersion: v1
  kind: Service
  metadata:
    name: nginx
  spec:
    ports:
      - port: 80
        protocol: TCP
    selector:
      app: nginx</code></pre></li>
</ul>
<h2 id="volume-ë§Œë“¤ê¸°">Volume ë§Œë“¤ê¸°</h2>
<h3 id="empty-dir">empty-dir</h3>
<p>í•œ pod ì•ˆì—ì„œ ë‘ê°œì˜ ì»¨í…Œì´ë„ˆê°€ ë””ë ‰í„°ë¦¬ë¥¼ ê³µìœ </p>
<h3 id="hostpath">hostpath</h3>
<p>í•œ pod ì•ˆì— ìˆëŠ” ë””ë ‰í„°ë¦¬ê°€ ì™¸ë¶€ ë””ë ‰í„°ë¦¬ì™€ ì—°ê²° ê°€ëŠ¥</p>
<p>ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” ë³¼ë¥¨ì„ ì—°ê²°í•˜ëŠ” ë°©ë²•ì„ ì¶”ìƒ</p>
<h2 id="configmap">ConfigMap</h2>
<p>íŠ¹ì •í™˜ê²½ë³€ìˆ˜ë¶€í„° íŠ¹ì • ì„¤ì • configê¹Œì§€ ê´€ë¦¬í•  ìˆ˜ ìˆìŒ</p>
<p>íŒŒì¼ì„ í†µì§¸ë¡œ ConfigMapìœ¼ë¡œ ë§Œë“  ë‹¤ìŒ ì»¨í…Œì´ë„ˆì—ì„œ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë´…ë‹ˆë‹¤.</p>
<p>`global:
  scrape_interval: 15s</p>
<p>scrape_configs:</p>
<ul>
<li>job_name: prometheus
metrics_path: /prometheus/metrics
static_configs:<ul>
<li>targets:<ul>
<li>localhost:9090`</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><a href="https://subicura.com/k8s/code/guide/configmap/config-file.yml"><strong>guide/configmap/config-file.ymlÂ (opens new window)</strong></a></p>
<p>ë¨¼ì €, ConfigMapì„ ë§Œë“­ë‹ˆë‹¤.Â <code>--from-file</code>Â ì˜µì…˜ì„ ì´ìš©í•˜ì—¬ fileì„ ì„¤ì •ìœ¼ë¡œ ë§Œë“­ë‹ˆë‹¤.</p>
<p>`# ConfitMap ìƒì„± configmap -&gt; cm
kubectl create cm my-config --from-file=config-file.yml</p>
<h1 id="confitmap-ì¡°íšŒ">ConfitMap ì¡°íšŒ</h1>
<p>kubectl get cm</p>
<h1 id="configmap-ë‚´ìš©-ìƒì„¸-ì¡°íšŒ">ConfigMap ë‚´ìš© ìƒì„¸ ì¡°íšŒ</h1>
<p>kubectl describe cm/my-config`</p>
<p>ìƒì„±í•œ ConfigMapì„Â <code>/etc/config</code>Â ë””ë ‰í† ë¦¬ì— ì—°ê²°í•©ë‹ˆë‹¤.</p>
<h2 id="secret">Secret</h2>
<p>ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ configMapì€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì €ì¥í•˜ê¸°ì—ëŠ” ì í•©í•˜ì§€ ì•ŠìŒ.</p>
<p>ë¹„ë°€ë²ˆí˜¸, SSH ì¸ì¦, TLS Secret ê³¼ ê°™ì€ ë³´ì•ˆì •ë³´ë¥¼ ê´€ë¦¬í•˜ëŠ” ê²ƒì€ Secret ì„ ì´ìš©.</p>
<p>ì‹¤ì œë¡œ ë°ì´í„°ê°€ ì•”í˜¸í™”ë˜ì§€ëŠ” ì•ŠìŒ.</p>
<p>ëª¨ë“  ìƒíƒœê°€ etcdì— í‰ë¬¸ìœ¼ë¡œ ì €ì¥ë˜ê¸° ë•Œë¬¸ì—, ìœ ì¶œê°€ëŠ¥ì„±ì´ ìˆìŒ.</p>
<p>secretì„ ì§ì ‘ ì‚¬ìš©í•˜ì§€ ì•Šê³ , í•˜ì‹œì½”í”„ì—ì„œ ë‚˜ì˜¨ ë²ŒíŠ¸ë¥¼ ì´ìš©í•´ì„œ ì•”í˜¸í™”ë¥¼ í•œë‹¤ë“ ê°€, ë³„ë„ì˜ ì•”í˜¸í™” ëª¨ë“ˆì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ì¶”ì²œ</p>
<pre><code>jMacui-iMac:secret ijaehui$ vi username.txt
jMacui-iMac:secret ijaehui$ vi password.txt
jMacui-iMac:secret ijaehui$ k create secret generic db-user-pass --from-file=./username/txt --from-file=./password.txt
error: error reading ./username/txt: no such file or directory
jMacui-iMac:secret ijaehui$ k create secret generic db-user-pass --from-file=./username.txt --from-file=./password.txt
secret/db-user-pass created
jMacui-iMac:secret ijaehui$ k get secret
NAME           TYPE     DATA   AGE
db-user-pass   Opaque   2      5s
jMacui-iMac:secret ijaehui$ k describe secret/db-user-pass
Name:         db-user-pass
Namespace:    default
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;

Type:  Opaque

Data
====
password.txt:  9 bytes
username.txt:  6 bytes
jMacui-iMac:secret ijaehui$ k get secret/db-user-pass -o yaml &lt;- output ì˜µì…˜ yaml
apiVersion: v1
data:
  password.txt: &lt;REDACTED&gt;  &lt;- base64 ë¡œ encoding
  username.txt: &lt;REDACTED&gt;
kind: Secret
metadata:
  creationTimestamp: "2023-05-24T01:41:02Z"
  name: db-user-pass
  namespace: default
  resourceVersion: "127241"
  uid: 6e47556c-10aa-44e7-ba56-7afbf88edec1
type: Opaque
jMacui-iMac:secret ijaehui$ **echo 'example_password' | base64 --decode**  &lt;- base64 ë¡œ decoding
</code></pre>